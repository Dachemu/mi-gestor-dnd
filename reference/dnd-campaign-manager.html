<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor de CampaÃ±as D&D - Ultimate Edition</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --primary: #8b5cf6;
            --primary-dark: #7c3aed;
            --primary-light: #a78bfa;
            --secondary: #ec4899;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
            --bg-dark: #0a0a0f;
            --bg-darker: #050508;
            --glass-bg: rgba(15, 15, 25, 0.85);
            --glass-border: rgba(139, 92, 246, 0.2);
            --text-primary: #ffffff;
            --text-secondary: #e5e7eb;
            --text-muted: #9ca3af;
            --text-disabled: #6b7280;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        html {
            background: var(--bg-dark);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            overflow-x: hidden;
            overflow-y: auto;
            line-height: 1.6;
            overscroll-behavior-y: none;
            min-height: 100vh;
        }

        /* OptimizaciÃ³n de performance con contain - ajustado para evitar problemas de renderizado */
        .contain-layout {
            contain: layout;
        }

        .contain-style {
            contain: style;
        }

        .contain-paint {
            contain: paint;
        }

        /* Scrollbar personalizada mejorada */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(31, 41, 55, 0.3);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 5px;
            transition: all 0.3s;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--primary-light), var(--primary));
        }

        /* Iconos Lucide optimizados */
        .lucide {
            width: 20px;
            height: 20px;
            stroke: currentColor;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
            fill: none;
            flex-shrink: 0;
            contain: strict;
        }

        /* Efectos de cristal mejorados con performance */
        .glass {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .glass-light {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            will-change: transform;
        }

        /* NavegaciÃ³n superior COMPLETAMENTE REDISEÃ‘ADA */
        .navigation-header {
            position: sticky;
            top: 0;
            z-index: 5000;
            background: rgba(20, 20, 35, 0.98);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border-bottom: 1px solid var(--glass-border);
            contain: layout style paint;
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .nav-brand {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-shrink: 0;
        }

        .nav-tabs-wrapper {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .nav-tabs-container {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            background: rgba(31, 41, 55, 0.4);
            padding: 0.25rem;
            border-radius: 12px;
            border: 1px solid rgba(139, 92, 246, 0.1);
        }

        .nav-tab {
            position: relative;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-weight: 500;
            font-size: 14px;
            transition: all 0.2s ease;
            cursor: pointer;
            border: none;
            background: transparent;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            white-space: nowrap;
            min-width: fit-content;
        }

        .nav-tab:hover {
            color: var(--text-secondary);
            background: rgba(139, 92, 246, 0.1);
        }

        .nav-tab.active {
            color: var(--text-primary);
            background: rgba(139, 92, 246, 0.25);
            box-shadow: 0 0 12px rgba(139, 92, 246, 0.3);
        }

        .nav-tab .lucide {
            width: 18px;
            height: 18px;
        }

        .nav-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-shrink: 0;
        }

        /* Search mejorado con icono bien posicionado */
        .search-container {
            position: relative;
            width: 280px;
            contain: layout;
            z-index: 6000;
        }

        .search-input-wrapper {
            position: relative;
            width: 100%;
        }

        .search-input {
            width: 100%;
            background: rgba(31, 41, 55, 0.6);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 12px;
            padding: 0.625rem 1rem 0.625rem 2.75rem;
            color: var(--text-primary);
            font-size: 14px;
            transition: all 0.2s ease;
            outline: none;
        }

        .search-input:focus {
            background: rgba(31, 41, 55, 0.8);
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.15);
        }

        .search-icon {
            position: absolute;
            left: 0.875rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            width: 18px;
            height: 18px;
            pointer-events: none;
            z-index: 1;
        }

        .search-dropdown {
            position: absolute;
            top: calc(100% + 0.5rem);
            left: 0;
            right: 0;
            background: rgba(20, 20, 35, 0.98);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            max-height: 400px;
            overflow-y: auto;
            overflow-x: hidden;
            overscroll-behavior: contain;
            z-index: 9999;
            animation: dropdownFadeIn 0.2s ease-out;
        }

        @keyframes dropdownFadeIn {
            from {
                opacity: 0;
                transform: translateY(-8px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Botones optimizados */
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 0.625rem 1.25rem;
            border-radius: 10px;
            font-weight: 600;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            font-size: 14px;
            letter-spacing: 0.025em;
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.25);
            will-change: transform;
            contain: layout style paint;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.35);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: transparent;
            color: var(--text-secondary);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.2s ease;
            border: 1px solid rgba(139, 92, 246, 0.3);
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 14px;
            will-change: transform;
            contain: layout style paint;
        }

        .btn-secondary:hover {
            background: rgba(139, 92, 246, 0.1);
            border-color: rgba(139, 92, 246, 0.5);
            color: var(--text-primary);
            transform: translateY(-1px);
        }

        /* Input field mejorado */
        .input-field {
            background: rgba(31, 41, 55, 0.5);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 10px;
            padding: 0.75rem 1rem;
            color: var(--text-primary);
            font-size: 15px;
            transition: all 0.2s ease;
            width: 100%;
            outline: none;
            contain: layout style;
        }

        .input-field:focus {
            background: rgba(31, 41, 55, 0.7);
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }

        /* WYSIWYG Editor COMPLETAMENTE NUEVO */
        .editor-container {
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--glass-border);
            background: rgba(31, 41, 55, 0.3);
            contain: layout style paint;
        }

        .editor-toolbar {
            background: rgba(31, 41, 55, 0.6);
            padding: 0.5rem;
            display: flex;
            gap: 0.25rem;
            align-items: center;
            border-bottom: 1px solid var(--glass-border);
            flex-wrap: wrap;
            contain: layout style;
        }

        .editor-btn {
            padding: 0.375rem;
            border-radius: 6px;
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.15s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            contain: layout style paint;
        }

        .editor-btn:hover {
            color: var(--text-primary);
            background: rgba(139, 92, 246, 0.15);
        }

        .editor-btn.active {
            background: var(--primary);
            color: white;
        }

        .editor-content {
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
            padding: 1rem;
            color: var(--text-primary);
            outline: none;
            font-size: 15px;
            line-height: 1.6;
            overscroll-behavior: contain;
            contain: layout style;
            font-weight: normal;
            font-style: normal;
            text-decoration: none;
            cursor: text;
            caret-color: var(--primary);
            position: relative;
        }

        .editor-content:focus {
            background: rgba(31, 41, 55, 0.4);
        }

        /* Placeholder del editor mejorado */
        .editor-content[data-placeholder]:empty:before {
            content: attr(data-placeholder);
            color: var(--text-disabled);
            pointer-events: none;
            display: block;
            font-weight: normal;
            position: absolute;
            top: 1rem;
            left: 1rem;
        }

        /* Reset de estilos para evitar negrita por defecto */
        .editor-content * {
            font-weight: inherit;
        }
        
        .editor-content div,
        .editor-content p {
            font-weight: normal;
            margin: 0;
            min-height: 1.5em;
        }
        
        /* Estilos para el contenido del editor */
        .editor-content h1,
        .editor-content h2,
        .editor-content h3 {
            color: var(--text-primary);
            margin-top: 1em;
            margin-bottom: 0.5em;
            font-weight: 600;
            line-height: 1.3;
        }

        .editor-content h1 { font-size: 1.75rem; }
        .editor-content h2 { font-size: 1.5rem; }
        .editor-content h3 { font-size: 1.25rem; }

        .editor-content p {
            margin-bottom: 0.75em;
        }

        .editor-content ul,
        .editor-content ol {
            margin-left: 1.5rem;
            margin-bottom: 0.75em;
            padding-left: 0.5rem;
            list-style-position: outside;
        }

        .editor-content ul {
            list-style-type: disc;
        }

        .editor-content ol {
            list-style-type: decimal;
        }

        .editor-content ul li,
        .editor-content ol li {
            margin-bottom: 0.25em;
            padding-left: 0.25rem;
            color: var(--text-primary);
        }

        .editor-content ul ul {
            list-style-type: circle;
            margin-top: 0.25em;
        }

        .editor-content ol ol {
            list-style-type: lower-alpha;
            margin-top: 0.25em;
        }

        .editor-content blockquote {
            border-left: 3px solid var(--primary);
            padding-left: 1rem;
            margin: 1em 0;
            font-style: italic;
            color: var(--text-muted);
        }

        .editor-content strong {
            font-weight: 600;
            color: var(--text-primary);
        }

        .editor-content em {
            font-style: italic;
        }

        .editor-content u {
            text-decoration: underline;
        }

        /* Modal mejorado con scroll isolation */
        .modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            animation: fadeIn 0.2s ease-out;
            overflow-y: auto;
            overscroll-behavior: contain;
        }

        .modal-content {
            background: var(--glass-bg);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: modalSlideIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            max-width: 90vw;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            position: relative;
            contain: layout style paint;
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid rgba(139, 92, 246, 0.2);
            flex-shrink: 0;
            contain: layout style;
        }

        .modal-body {
            flex: 1;
            overflow-y: auto;
            overscroll-behavior: contain;
            padding: 1.5rem;
            contain: layout style;
        }

        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid rgba(139, 92, 246, 0.2);
            flex-shrink: 0;
            contain: layout style;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes modalSlideIn {
            from {
                transform: scale(0.95) translateY(20px);
                opacity: 0;
            }
            to {
                transform: scale(1) translateY(0);
                opacity: 1;
            }
        }

        /* Cards optimizadas */
        .card {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 1.5rem;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
            will-change: transform;
            contain: layout style paint;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.4);
            border-color: rgba(139, 92, 246, 0.4);
        }

        /* PartÃ­culas de fondo optimizadas */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .particle {
            position: absolute;
            background: radial-gradient(circle, rgba(139, 92, 246, 0.3) 0%, transparent 70%);
            border-radius: 50%;
            animation: float 25s infinite linear;
            will-change: transform;
            opacity: 0.7;
        }

        @keyframes float {
            from {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.7;
            }
            90% {
                opacity: 0.7;
            }
            to {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }

        /* Gradiente de fondo optimizado */
        /* Gradiente de fondo animado */
        .gradient-bg {
            background: linear-gradient(135deg, #0a0a0f 0%, #15082a 25%, #0a0a0f 50%, #0a1525 75%, #0a0a0f 100%);
            background-size: 200% 200%;
            animation: gradientShift 30s ease infinite;
            min-height: 100vh;
            position: relative;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Badge styles optimizados */
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.15s ease;
            contain: layout style paint;
        }

        .badge-primary {
            background: rgba(139, 92, 246, 0.2);
            color: var(--primary-light);
        }

        .badge-success {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .badge-warning {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
        }

        .badge-danger {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .badge-info {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
        }

        /* Emoji picker optimizado */
        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(48px, 1fr));
            gap: 0.25rem;
            padding: 1rem;
            max-height: 300px;
            overflow-y: auto;
            overscroll-behavior: contain;
        }

        .emoji-button {
            aspect-ratio: 1;
            padding: 0.5rem;
            border-radius: 8px;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.15s ease;
            border: none;
            background: transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            will-change: transform;
            contain: layout style paint;
        }

        .emoji-button:hover {
            background: rgba(139, 92, 246, 0.2);
            transform: scale(1.15);
        }

        /* Empty state optimizado */
        .empty-state {
            text-align: center;
            padding: 4rem 1rem;
            contain: layout style;
        }

        .empty-state-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 1.5rem;
            color: var(--text-disabled);
            opacity: 0.5;
        }

        /* Formatted content optimizado */
        .formatted-content {
            color: var(--text-secondary);
            line-height: 1.6;
            word-wrap: break-word;
            overflow-wrap: break-word;
            contain: layout style;
        }

        .formatted-content h1,
        .formatted-content h2,
        .formatted-content h3 {
            color: var(--text-primary);
            margin-top: 1em;
            margin-bottom: 0.5em;
            font-weight: 600;
        }

        .formatted-content h1 { font-size: 1.75rem; }
        .formatted-content h2 { font-size: 1.5rem; }
        .formatted-content h3 { font-size: 1.25rem; }

        .formatted-content p {
            margin-bottom: 0.75em;
        }

        .formatted-content ul,
        .formatted-content ol {
            margin-left: 1.5rem;
            margin-bottom: 0.75em;
            padding-left: 0.5rem;
            list-style-position: outside;
        }

        .formatted-content ul {
            list-style-type: disc;
        }

        .formatted-content ol {
            list-style-type: decimal;
        }

        .formatted-content ul li,
        .formatted-content ol li {
            margin-bottom: 0.25em;
            padding-left: 0.25rem;
            color: var(--text-primary);
        }

        .formatted-content ul ul {
            list-style-type: circle;
            margin-top: 0.25em;
        }

        .formatted-content ol ol {
            list-style-type: lower-alpha;
            margin-top: 0.25em;
        }

        .formatted-content blockquote {
            border-left: 4px solid var(--primary);
            padding-left: 1rem;
            margin: 1em 0;
            font-style: italic;
            color: var(--text-muted);
        }

        .formatted-content strong {
            font-weight: 600;
            color: var(--text-primary);
        }

        .formatted-content em {
            font-style: italic;
        }

        .formatted-content u {
            text-decoration: underline;
        }

        .formatted-content::selection {
            background: rgba(139, 92, 246, 0.4);
            color: white;
        }

        .formatted-content *::selection {
            background: rgba(139, 92, 246, 0.4);
            color: white;
        }

        /* Custom Select optimizado */
        .custom-select {
            position: relative;
            user-select: none;
            contain: layout;
        }

        .custom-select-trigger {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 1rem;
            background: rgba(31, 41, 55, 0.5);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 10px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 15px;
            font-weight: 500;
        }

        .custom-select-dropdown {
            position: absolute;
            top: calc(100% + 0.25rem);
            left: 0;
            right: 0;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            opacity: 0;
            transform: translateY(-8px);
            pointer-events: none;
            transition: all 0.2s ease;
            z-index: 100;
            max-height: 300px;
            overflow-y: auto;
            overscroll-behavior: contain;
            contain: layout style paint;
        }

        .custom-select.open .custom-select-dropdown {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }

        /* Tab pills optimizados */
        .tab-pills {
            display: flex;
            gap: 0.5rem;
            padding: 0.25rem;
            background: rgba(31, 41, 55, 0.3);
            border-radius: 12px;
            overflow-x: auto;
            scrollbar-width: thin;
            contain: layout style;
        }

        .tab-pill {
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.15s ease;
            border: none;
            background: transparent;
            color: var(--text-muted);
            contain: layout style paint;
        }

        .tab-pill:hover {
            background: rgba(139, 92, 246, 0.1);
            color: var(--text-secondary);
        }

        .tab-pill.active {
            background: var(--primary);
            color: white;
        }

        /* Utilities optimizadas */
        .no-select {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .line-clamp-3 {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .divider-vertical {
            width: 1px;
            height: 20px;
            background: rgba(139, 92, 246, 0.3);
            margin: 0 0.5rem;
        }

        /* Responsive optimizado */
        @media (max-width: 1024px) {
            .nav-container {
                flex-wrap: wrap;
                gap: 1rem;
            }

            .nav-tabs-wrapper {
                order: 2;
                width: 100%;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .search-container {
                width: 100%;
            }
        }

        @media (max-width: 768px) {
            .card {
                padding: 1rem;
            }
            
            .modal-content {
                margin: 0.5rem;
                max-width: 100%;
            }
            
            .nav-tab {
                padding: 0.375rem 0.75rem;
                font-size: 13px;
            }

            .nav-tab .lucide {
                width: 16px;
                height: 16px;
            }

            .emoji-grid {
                grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
            }
        }

        /* Grid responsive optimizado */
        .responsive-grid {
            display: grid;
            gap: 1.5rem;
            contain: layout;
        }

        @media (min-width: 640px) {
            .responsive-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 1024px) {
            .responsive-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        /* Category nav optimizado */
        .category-nav {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
            contain: layout;
        }

        .category-button {
            padding: 1.5rem;
            border-radius: 16px;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
            border: 2px solid transparent;
            background: rgba(20, 20, 35, 0.6);
            cursor: pointer;
            will-change: transform;
            contain: layout style paint;
        }

        .category-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--color-start), var(--color-end));
            opacity: 0.1;
            transition: opacity 0.2s ease;
        }

        .category-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
        }

        .category-button:hover::before {
            opacity: 0.2;
        }

        .category-button.active {
            border-color: currentColor;
            background: rgba(20, 20, 35, 0.8);
        }

        .category-button.active::before {
            opacity: 0.25;
        }

        /* Stat cards optimizados */
        .stat-card {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.2s ease;
            will-change: transform;
            contain: layout style paint;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
            border-color: rgba(139, 92, 246, 0.4);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 0.75rem 0 0.25rem;
        }

        /* Connection indicator optimizado */
        .connection-indicator {
            position: absolute;
            top: -0.5rem;
            right: -0.5rem;
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, var(--info), var(--primary));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: bold;
            color: white;
            box-shadow: 0 2px 8px rgba(139, 92, 246, 0.4);
            animation: pulse 2s infinite;
            contain: layout style paint;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        #root {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
            z-index: 2;
            margin: 0;
            padding: 0;
        }
        
        /* Fix para el contenido principal */
        .main-content {
            position: relative;
            z-index: 10;
            min-height: calc(100vh - 100px);
            flex: 1;
        }
        
        .content-panel {
            position: relative;
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 2rem;
            min-height: 600px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            overflow: visible;
        }
        .campaign-title {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            line-height: 1.2;
            contain: layout style;
        }

        /* Field label y hint optimizados */
        .field-label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: var(--primary-light);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .field-hint {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 0.375rem;
            font-style: italic;
        }

        /* Loading spinner optimizado */
        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid var(--glass-border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Fade in animation optimizada */
        .fade-in {
            animation: fadeInUp 0.4s ease-out forwards;
            opacity: 0;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Note card optimizado */
        .note-card {
            background: rgba(55, 65, 81, 0.5);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            transition: all 0.2s ease;
            cursor: pointer;
            border: 1px solid transparent;
            will-change: transform;
            contain: layout style paint;
        }

        .note-card:hover {
            background: rgba(55, 65, 81, 0.7);
            transform: translateX(4px);
            border-color: rgba(139, 92, 246, 0.3);
        }

        /* Search result item optimizado */
        .search-result-item {
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: all 0.15s ease;
            border-bottom: 1px solid rgba(139, 92, 246, 0.1);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            contain: layout style paint;
        }

        .search-result-item:hover {
            background: rgba(139, 92, 246, 0.15);
            padding-left: 1.25rem;
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .search-result-type {
            font-size: 10px;
            background: rgba(139, 92, 246, 0.3);
            color: var(--primary-light);
            padding: 0.125rem 0.5rem;
            border-radius: 10px;
            text-transform: uppercase;
            font-weight: 600;
        }

        /* Tooltip optimizado */
        .tooltip {
            position: relative;
        }

        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(-8px);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 13px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: all 0.2s ease;
            z-index: 100;
        }

        .tooltip:hover::after {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
    </style>
</head>
<body>
    <div class="particles" id="particles"></div>
    <div id="root"></div>
    
    <script type="text/babel">
        // Iconos SVG como componentes React
        const Icons = {
            MapPin: () => (
                <svg className="lucide" viewBox="0 0 24 24">
                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                    <circle cx="12" cy="10" r="3"/>
                </svg>
            ),
            Users: () => (
                <svg className="lucide" viewBox="0 0 24 24">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                    <circle cx="9" cy="7" r="4"/>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/>
                </svg>
            ),
            User: () => (
                <svg className="lucide" viewBox="0 0 24 24">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                    <circle cx="12" cy="7" r="4"/>
                </svg>
            ),
            Scroll: () => (
                <svg className="lucide" viewBox="0 0 24 24">
                    <path d="M8 21h12a2 2 0 0 0 2-2v-2H10v2a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v3h4"/>
                    <path d="M19 17V5a2 2 0 0 0-2-2H4"/>
                </svg>
            ),
            Package: () => (
                <svg className="lucide" viewBox="0 0 24 24">
                    <path d="M16.5 9.4l-9-5.19M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                    <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
                    <line x1="12" y1="22.08" x2="12" y2="12"/>
                </svg>
            ),
            StickyNote: () => (
                <svg className="lucide" viewBox="0 0 24 24">
                    <path d="M16 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8Z"/>
                    <path d="M15 3v4a2 2 0 0 0 2 2h4"/>
                </svg>
            ),
            Home: () => (
                <svg className="lucide" viewBox="0 0 24 24">
                    <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                    <polyline points="9 22 9 12 15 12 15 22"/>
                </svg>
            ),
            Plus: () => (
                <svg className="lucide" viewBox="0 0 24 24">
                    <line x1="12" y1="5" x2="12" y2="19"/>
                    <line x1="5" y1="12" x2="19" y2="12"/>
                </svg>
            ),
            X: () => (
                <svg className="lucide" viewBox="0 0 24 24">
                    <line x1="18" y1="6" x2="6" y2="18"/>
                    <line x1="6" y1="6" x2="18" y2="18"/>
                </svg>
            ),
            Edit2: () => (
                <svg className="lucide" viewBox="0 0 24 24">
                    <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/>
                </svg>
            ),
            Trash2: () => (
                <svg className="lucide" viewBox="0 0 24 24">
                    <polyline points="3 6 5 6 21 6"/>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                    <line x1="10" y1="11" x2="10" y2="17"/>
                    <line x1="14" y1="11" x2="14" y2="17"/>
                </svg>
            ),
            Save: () => (
                <svg className="lucide" viewBox="0 0 24 24">
                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                    <polyline points="17 21 17 13 7 13 7 21"/>
                    <polyline points="7 3 7 8 15 8"/>
                </svg>
            ),
            Download: () => (
                <svg className="lucide" viewBox="0 0 24 24">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                    <polyline points="7 10 12 15 17 10"/>
                    <line x1="12" y1="15" x2="12" y2="3"/>
                </svg>
            ),
            Upload: () => (
                <svg className="lucide" viewBox="0 0 24 24">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                    <polyline points="17 8 12 3 7 8"/>
                    <line x1="12" y1="3" x2="12" y2="15"/>
                </svg>
            ),
            ArrowLeft: () => (
                <svg className="lucide" viewBox="0 0 24 24">
                    <line x1="19" y1="12" x2="5" y2="12"/>
                    <polyline points="12 19 5 12 12 5"/>
                </svg>
            ),
            Search: () => (
                <svg className="lucide" viewBox="0 0 24 24">
                    <circle cx="11" cy="11" r="8"/>
                    <path d="m21 21-4.35-4.35"/>
                </svg>
            ),
            Sparkles: () => (
                <svg className="lucide" viewBox="0 0 24 24">
                    <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/>
                    <path d="M5 3v4M19 17v4M3 5h4M17 19h4"/>
                </svg>
            ),
            Link2: () => (
                <svg className="lucide" viewBox="0 0 24 24">
                    <path d="M15 7h3a5 5 0 0 1 0 10h-3m-6 0H6a5 5 0 0 1 0-10h3"/>
                    <line x1="8" y1="12" x2="16" y2="12"/>
                </svg>
            ),
            ChevronDown: () => (
                <svg className="lucide" viewBox="0 0 24 24">
                    <polyline points="6 9 12 15 18 9"/>
                </svg>
            ),
            Target: () => (
                <svg className="lucide" viewBox="0 0 24 24">
                    <circle cx="12" cy="12" r="10"/>
                    <circle cx="12" cy="12" r="6"/>
                    <circle cx="12" cy="12" r="2"/>
                </svg>
            ),
            Star: () => (
                <svg className="lucide" viewBox="0 0 24 24">
                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                </svg>
            ),
            Bold: () => (
                <svg className="lucide" viewBox="0 0 24 24">
                    <path d="M6 4h8a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6zM6 12h9a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"/>
                </svg>
            ),
            Italic: () => (
                <svg className="lucide" viewBox="0 0 24 24">
                    <line x1="19" y1="4" x2="10" y2="4"/>
                    <line x1="14" y1="20" x2="5" y2="20"/>
                    <line x1="15" y1="4" x2="9" y2="20"/>
                </svg>
            ),
            List: () => (
                <svg className="lucide" viewBox="0 0 24 24">
                    <line x1="8" y1="6" x2="21" y2="6"/>
                    <line x1="8" y1="12" x2="21" y2="12"/>
                    <line x1="8" y1="18" x2="21" y2="18"/>
                    <line x1="3" y1="6" x2="3.01" y2="6"/>
                    <line x1="3" y1="12" x2="3.01" y2="12"/>
                    <line x1="3" y1="18" x2="3.01" y2="18"/>
                </svg>
            ),
            ListOrdered: () => (
                <svg className="lucide" viewBox="0 0 24 24">
                    <line x1="10" y1="6" x2="21" y2="6"/>
                    <line x1="10" y1="12" x2="21" y2="12"/>
                    <line x1="10" y1="18" x2="21" y2="18"/>
                    <path d="M4 6h1v4"/>
                    <path d="M4 10h2"/>
                    <path d="M6 18H4c0-1 2-2 2-3s-1-1.5-2-1"/>
                </svg>
            ),
            Quote: () => (
                <svg className="lucide" viewBox="0 0 24 24">
                    <path d="M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V20c0 1 0 1 1 1z"/>
                    <path d="M15 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2h-4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2h.75c0 2.25.25 4-2.75 4v3c0 1 0 1 1 1z"/>
                </svg>
            ),
            Underline: () => (
                <svg className="lucide" viewBox="0 0 24 24">
                    <path d="M6 3v7a6 6 0 0 0 6 6 6 6 0 0 0 6-6V3"/>
                    <line x1="4" y1="21" x2="20" y2="21"/>
                </svg>
            ),
            CheckSquare: () => (
                <svg className="lucide" viewBox="0 0 24 24">
                    <polyline points="9 11 12 14 22 4"/>
                    <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
                </svg>
            ),
            Menu: () => (
                <svg className="lucide" viewBox="0 0 24 24">
                    <line x1="3" y1="12" x2="21" y2="12"/>
                    <line x1="3" y1="6" x2="21" y2="6"/>
                    <line x1="3" y1="18" x2="21" y2="18"/>
                </svg>
            )
        };

        const { useState, useEffect, useCallback, useRef, useMemo, memo } = React;

        // ConfiguraciÃ³n y constantes
        const TAB_ORDER = ['dashboard', 'locations', 'players', 'npcs', 'objects', 'quests', 'notes'];
        
        const TAB_CONFIG = {
            dashboard: { name: 'Dashboard', icon: Icons.Home, color: 'purple' },
            locations: { name: 'Lugares', icon: Icons.MapPin, color: 'blue' },
            players: { name: 'Jugadores', icon: Icons.Users, color: 'green' },
            npcs: { name: 'NPCs', icon: Icons.User, color: 'purple' },
            objects: { name: 'Objetos', icon: Icons.Package, color: 'cyan' },
            quests: { name: 'Misiones', icon: Icons.Scroll, color: 'orange' },
            notes: { name: 'Notas', icon: Icons.StickyNote, color: 'blue' }
        };

        const EMOJI_CATEGORIES = {
            personas: {
                name: "Personas",
                emojis: ["ğŸ§™", "ğŸ§™â€â™€ï¸", "ğŸ§™â€â™‚ï¸", "ğŸ¤´", "ğŸ‘¸", "ğŸ§", "ğŸ§â€â™€ï¸", "ğŸ§â€â™‚ï¸", "ğŸ§›", "ğŸ§›â€â™€ï¸", "ğŸ§›â€â™‚ï¸", "ğŸ§š", "ğŸ§šâ€â™€ï¸", "ğŸ§šâ€â™‚ï¸", "ğŸ§", "ğŸ§â€â™€ï¸", "ğŸ§â€â™‚ï¸", "ğŸ§Ÿ", "ğŸ§Ÿâ€â™€ï¸", "ğŸ§Ÿâ€â™‚ï¸", "ğŸ¦¸", "ğŸ¦¸â€â™€ï¸", "ğŸ¦¸â€â™‚ï¸", "ğŸ¦¹", "ğŸ¦¹â€â™€ï¸", "ğŸ¦¹â€â™‚ï¸", "ğŸ¤º", "ğŸ¥·", "ğŸ’‚", "ğŸ’‚â€â™€ï¸", "ğŸ’‚â€â™‚ï¸", "ğŸ‘·", "ğŸ‘·â€â™€ï¸", "ğŸ‘·â€â™‚ï¸", "ğŸ•µï¸", "ğŸ•µï¸â€â™€ï¸", "ğŸ•µï¸â€â™‚ï¸", "ğŸ‘¨â€âš•ï¸", "ğŸ‘©â€âš•ï¸", "ğŸ§‘â€âš•ï¸", "ğŸ‘¨â€ğŸŒ¾", "ğŸ‘©â€ğŸŒ¾", "ğŸ§‘â€ğŸŒ¾", "ğŸ‘¨â€ğŸ³", "ğŸ‘©â€ğŸ³", "ğŸ§‘â€ğŸ³", "ğŸ‘¨â€ğŸ«", "ğŸ‘©â€ğŸ«", "ğŸ§‘â€ğŸ«", "ğŸ‘¨â€âš–ï¸", "ğŸ‘©â€âš–ï¸", "ğŸ§‘â€âš–ï¸", "ğŸ§”", "ğŸ§”â€â™€ï¸", "ğŸ§”â€â™‚ï¸", "ğŸ‘²", "ğŸ‘³", "ğŸ‘³â€â™€ï¸", "ğŸ‘³â€â™‚ï¸", "ğŸ§•", "ğŸ‘®", "ğŸ‘®â€â™€ï¸", "ğŸ‘®â€â™‚ï¸", "ğŸ‘´", "ğŸ‘µ", "ğŸ§“", "ğŸ‘¶", "ğŸ‘§", "ğŸ§’", "ğŸ‘¦", "ğŸ‘±", "ğŸ‘±â€â™€ï¸", "ğŸ‘±â€â™‚ï¸"]
            },
            lugares: {
                name: "Lugares",
                emojis: ["ğŸ°", "ğŸ¯", "ğŸ—¼", "â›ª", "ğŸ•Œ", "ğŸ›•", "ğŸ•", "â›©ï¸", "ğŸ›ï¸", "ğŸ—¿", "ğŸšï¸", "ğŸ˜ï¸", "ğŸ™ï¸", "ğŸŒ‹", "â›°ï¸", "ğŸ”ï¸", "ğŸ—»", "ğŸï¸", "ğŸœï¸", "ğŸ–ï¸", "ğŸï¸", "ğŸŒŠ", "ğŸŒ…", "ğŸŒ„", "ğŸŒƒ", "ğŸŒŒ", "ğŸŒ‰", "ğŸª", "ğŸ­", "ğŸŸï¸", "ğŸ—ï¸", "ğŸ§±", "ğŸª¨", "ğŸªµ", "ğŸ•ï¸", "ğŸ›–", "â›º", "ğŸŒ", "ğŸŒ†", "ğŸŒ‡", "ğŸ’’", "ğŸ©", "ğŸ¨", "ğŸ¦", "ğŸª", "ğŸ¬", "ğŸ£", "ğŸ¤", "ğŸ¥", "ğŸ¢", "ğŸ­", "ğŸ¡", "ğŸ ", "â›²", "ğŸŒ³", "ğŸŒ²", "ğŸŒ´", "ğŸŒµ", "ğŸŒ¾", "ğŸŒ¿", "â˜˜ï¸", "ğŸ€", "ğŸ„", "ğŸŒ°", "ğŸŒ", "ğŸŒ", "ğŸŒ", "ğŸŒ", "ğŸ—ºï¸", "ğŸ§­"]
            },
            magia: {
                name: "Magia",
                emojis: ["ğŸ”®", "ğŸ±", "ğŸ“¿", "ğŸ§¿", "ğŸª¬", "âš—ï¸", "ğŸ§ª", "ğŸ’«", "â­", "ğŸŒŸ", "âœ¨", "âš¡", "ğŸ”¥", "ğŸ’¥", "â˜„ï¸", "ğŸŒ ", "ğŸŒŒ", "ğŸŒˆ", "ğŸ†", "ğŸ‡", "ğŸƒ", "ğŸ‘»", "ğŸ’€", "â˜ ï¸", "ğŸ‘¹", "ğŸ‘º", "ğŸ˜ˆ", "ğŸ‘¿", "ğŸ­", "ğŸ¦„", "ğŸ‰", "ğŸ²", "ğŸ•¯ï¸", "ğŸª”", "ğŸ“œ", "ğŸ“–", "ğŸ“š", "ğŸ—ï¸", "ğŸ”‘", "ğŸ—¡ï¸", "âš”ï¸", "ğŸ›¡ï¸", "ğŸ¹", "ğŸª„", "ğŸ”±", "ğŸª™", "ğŸ’", "ğŸ’", "ğŸ‘‘", "ğŸ†", "ğŸ…", "ğŸ–ï¸", "ğŸ—ï¸", "ğŸŸï¸", "ğŸ«", "ğŸª", "ğŸ¨", "ğŸ–¼ï¸", "ğŸ¯", "ğŸ²", "â™Ÿï¸", "ğŸƒ", "ğŸ€„", "ğŸ´", "ğŸ°", "ğŸ§©", "ğŸª…", "ğŸª†"]
            },
            naturaleza: {
                name: "Naturaleza",
                emojis: ["ğŸº", "ğŸ¦…", "ğŸ¦‰", "ğŸ¦‡", "ğŸ—", "ğŸ¦Œ", "ğŸ¦", "ğŸ¦›", "ğŸ˜", "ğŸ¦’", "ğŸ¦˜", "ğŸ¦¬", "ğŸƒ", "ğŸ‚", "ğŸ„", "ğŸ", "ğŸ¦“", "ğŸ¦", "ğŸ¦§", "ğŸ†", "ğŸ…", "ğŸ¦", "ğŸ¯", "ğŸˆ", "ğŸˆâ€â¬›", "ğŸ¦", "ğŸ¦¨", "ğŸ¦¡", "ğŸ¦«", "ğŸ¦¦", "ğŸ¦¥", "ğŸ", "ğŸ€", "ğŸ¿ï¸", "ğŸ¦”", "ğŸ‡", "ğŸ°", "ğŸ¦", "ğŸ", "ğŸ¢", "ğŸŠ", "ğŸ¦•", "ğŸ¦–", "ğŸ¦‚", "ğŸ•·ï¸", "ğŸ•¸ï¸", "ğŸ", "ğŸª²", "ğŸ", "ğŸ¦—", "ğŸª°", "ğŸª±", "ğŸ¦Ÿ", "ğŸ¦ ", "ğŸ™", "ğŸ¦‘", "ğŸ¦€", "ğŸ¦", "ğŸ¦", "ğŸ¦ª", "ğŸš", "ğŸ ", "ğŸŸ", "ğŸ¡", "ğŸ‹", "ğŸ¦ˆ", "ğŸ¦­", "ğŸ¦¢", "ğŸ¦š", "ğŸ¦œ", "ğŸ¦©", "ğŸ•Šï¸", "ğŸ¦ƒ", "ğŸ¦†"]
            },
            objetos: {
                name: "Objetos",
                emojis: ["âš”ï¸", "ğŸ—¡ï¸", "ğŸ›¡ï¸", "ğŸ¹", "ğŸª“", "ğŸ”¨", "â›ï¸", "ğŸª", "ğŸ”±", "ğŸª„", "ğŸ’£", "ğŸ§¨", "ğŸ”¥", "ğŸ’", "ğŸ’°", "ğŸ’µ", "ğŸª™", "ğŸ’", "ğŸ‘‘", "ğŸ©", "ğŸ“", "â›‘ï¸", "ğŸª–", "ğŸ“¿", "ğŸ””", "ğŸº", "ğŸ¥", "ğŸª˜", "ğŸª•", "ğŸ»", "ğŸªˆ", "ğŸ¸", "ğŸ¹", "ğŸµ", "ğŸ¶", "ğŸ¼", "ğŸ¤", "ğŸ§", "ğŸ“»", "ğŸ®", "ğŸ•¹ï¸", "ğŸ°", "ğŸ²", "â™Ÿï¸", "ğŸ¯", "ğŸ³", "ğŸª€", "ğŸª", "ğŸ†", "ğŸ…", "ğŸ¥‡", "ğŸ¥ˆ", "ğŸ¥‰", "ğŸ–ï¸", "ğŸµï¸", "ğŸ—ï¸", "ğŸ«", "ğŸŸï¸", "ğŸ—ï¸", "ğŸ”‘", "ğŸ”", "ğŸ”’", "ğŸ”“", "ğŸ”", "ğŸ§°", "ğŸª›", "ğŸ”§", "ğŸ”©", "âš™ï¸", "ğŸ§²", "ğŸ”«", "ğŸº", "ğŸ•¯ï¸", "ğŸª”", "ğŸ’¡", "ğŸ”¦", "ğŸ®", "ğŸªŸ", "ğŸªœ", "ğŸ§¯", "ğŸ›¢ï¸", "âš±ï¸", "ğŸª¦", "âš°ï¸", "ğŸš¬", "ğŸ”¬", "ğŸ”­", "ğŸ“¡", "ğŸ’‰", "ğŸ©¸", "ğŸ’Š", "ğŸ©¹", "ğŸ©º", "ğŸ§¬", "ğŸ§ª", "ğŸ§«", "âš—ï¸", "ğŸ“œ", "ğŸ“‹", "ğŸ“Š", "ğŸ“ˆ", "ğŸ“‰", "ğŸ“š", "ğŸ“–", "ğŸ“•", "ğŸ“—", "ğŸ“˜", "ğŸ“™", "ğŸ““", "ğŸ“”", "ğŸ“’", "ğŸ“", "âœï¸", "âœ’ï¸", "ğŸ–‹ï¸", "ğŸ–Šï¸", "ğŸ–Œï¸", "ğŸ–ï¸"]
            }
        };

        // Utilidades
        const generateId = () => `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;

        const createEmptyCampaignStructure = () => ({
            locations: [],
            players: [],
            npcs: [],
            objects: [],
            quests: [],
            notes: [],
            timeline: [],
            tags: []
        });

        const normalizeItem = (item) => ({
            ...item,
            id: item.id || generateId(),
            createdAt: item.createdAt || new Date().toISOString(),
            linkedItems: item.linkedItems || {}
        });

        const normalizeCampaign = (campaign) => {
            const normalized = {
                ...createEmptyCampaignStructure(),
                ...campaign,
                id: campaign.id || generateId(),
                name: campaign.name || 'CampaÃ±a sin nombre',
                description: campaign.description || '',
                createdAt: campaign.createdAt || new Date().toISOString(),
                lastModified: campaign.lastModified || new Date().toISOString()
            };
            
            ['locations', 'players', 'npcs', 'objects', 'quests', 'notes'].forEach(key => {
                if (!Array.isArray(normalized[key])) {
                    normalized[key] = [];
                } else {
                    normalized[key] = normalized[key].map(normalizeItem);
                }
            });
            
            if (!Array.isArray(normalized.timeline)) normalized.timeline = [];
            if (!Array.isArray(normalized.tags)) normalized.tags = [];
            
            return normalized;
        };

        // Funciones de utilidad para estilos
        const getStatusColor = (status) => ({
            'En progreso': 'text-yellow-400',
            'Completada': 'text-green-400',
            'Pendiente': 'text-gray-400'
        }[status] || 'text-gray-400');

        const getPriorityColor = (priority) => ({
            'Alta': 'badge-danger',
            'Media': 'badge-warning',
            'Baja': 'badge-success',
            'CrÃ­tica': 'badge-primary'
        }[priority] || 'badge-info');

        const getAttitudeColor = (attitude) => ({
            'Amistoso': 'text-green-400',
            'Neutral': 'text-yellow-400',
            'Hostil': 'text-red-400'
        }[attitude] || 'text-gray-400');

        const getRarityColor = (rarity) => ({
            'ComÃºn': 'badge-secondary',
            'Poco comÃºn': 'badge-success',
            'Raro': 'badge-info',
            'Ã‰pico': 'badge-primary',
            'Legendario': 'badge-warning'
        }[rarity] || 'badge-secondary');

        // Editor WYSIWYG completamente nuevo y optimizado
        const WYSIWYGEditor = memo(({ value = '', onChange, placeholder = 'Escribe aquÃ­...' }) => {
            const editorRef = useRef(null);
            const [activeFormats, setActiveFormats] = useState({
                bold: false,
                italic: false,
                underline: false
            });
            const isInternalChange = useRef(false);
            const lastValue = useRef(value);
            const debounceTimer = useRef(null);

            // Inicializar contenido
            useEffect(() => {
                if (editorRef.current && value !== lastValue.current && !isInternalChange.current) {
                    lastValue.current = value;
                    editorRef.current.innerHTML = value || '<p><br></p>';
                }
            }, [value]);

            // Cleanup del timer
            useEffect(() => {
                return () => {
                    if (debounceTimer.current) {
                        clearTimeout(debounceTimer.current);
                    }
                };
            }, []);

            // Aplicar formato con mejor manejo
            const applyFormat = useCallback((command, value = null) => {
                editorRef.current.focus();
                
                // Guardar selecciÃ³n actual
                const selection = window.getSelection();
                const range = selection.rangeCount > 0 ? selection.getRangeAt(0) : null;
                
                // Ejecutar comando
                document.execCommand(command, false, value);
                
                // Restaurar selecciÃ³n y actualizar
                if (range) {
                    selection.removeAllRanges();
                    selection.addRange(range);
                }
                
                // Actualizar contenido despuÃ©s de un pequeÃ±o delay
                setTimeout(() => {
                    handleContentChange();
                    updateActiveFormats();
                }, 10);
            }, []);

            // Manejar cambios de contenido con debounce mejorado
            const handleContentChange = useCallback(() => {
                if (!editorRef.current || isInternalChange.current) return;
                
                // Cancelar el timer anterior si existe
                if (debounceTimer.current) {
                    clearTimeout(debounceTimer.current);
                }
                
                // Establecer un nuevo timer
                debounceTimer.current = setTimeout(() => {
                    const newContent = editorRef.current.innerHTML;
                    if (newContent !== lastValue.current) {
                        isInternalChange.current = true;
                        lastValue.current = newContent;
                        onChange(newContent);
                        
                        // Reset flag
                        setTimeout(() => {
                            isInternalChange.current = false;
                        }, 50);
                    }
                }, 100); // Debounce de 100ms
            }, [onChange]);

            // Actualizar estados de formato activos
            const updateActiveFormats = useCallback(() => {
                try {
                    setActiveFormats({
                        bold: document.queryCommandState('bold'),
                        italic: document.queryCommandState('italic'),
                        underline: document.queryCommandState('underline')
                    });
                } catch (e) {
                    // Ignorar errores si la selecciÃ³n no es vÃ¡lida
                }
            }, []);

            // Manejar teclas especiales
            const handleKeyDown = useCallback((e) => {
                if (e.ctrlKey || e.metaKey) {
                    switch (e.key.toLowerCase()) {
                        case 'b':
                            e.preventDefault();
                            applyFormat('bold');
                            break;
                        case 'i':
                            e.preventDefault();
                            applyFormat('italic');
                            break;
                        case 'u':
                            e.preventDefault();
                            applyFormat('underline');
                            break;
                    }
                }
                
                // Manejar Enter en listas y pÃ¡rrafos
                if (e.key === 'Enter') {
                    const selection = window.getSelection();
                    const anchorNode = selection.anchorNode;
                    const parentElement = anchorNode?.nodeType === Node.TEXT_NODE 
                        ? anchorNode.parentElement 
                        : anchorNode;
                    
                    // Si estamos en una lista vacÃ­a, salir de la lista
                    if (parentElement && (parentElement.tagName === 'LI' || parentElement.closest('li'))) {
                        const li = parentElement.tagName === 'LI' ? parentElement : parentElement.closest('li');
                        if (li && li.textContent.trim() === '') {
                            e.preventDefault();
                            const ul = li.parentElement;
                            const p = document.createElement('p');
                            p.innerHTML = '<br>';
                            
                            if (ul.nextSibling) {
                                ul.parentNode.insertBefore(p, ul.nextSibling);
                            } else {
                                ul.parentNode.appendChild(p);
                            }
                            
                            li.remove();
                            
                            // Mover cursor al nuevo pÃ¡rrafo
                            const range = document.createRange();
                            range.selectNodeContents(p);
                            range.collapse(false);
                            selection.removeAllRanges();
                            selection.addRange(range);
                            
                            handleContentChange();
                        }
                    } else if (!parentElement || parentElement === editorRef.current || 
                               (!['P', 'H1', 'H2', 'H3', 'BLOCKQUOTE', 'LI'].includes(parentElement.tagName))) {
                        // Si no estamos en un elemento de bloque, crear un pÃ¡rrafo
                        e.preventDefault();
                        document.execCommand('formatBlock', false, '<p>');
                        document.execCommand('insertHTML', false, '<br>');
                        handleContentChange();
                    }
                }
            }, [applyFormat, handleContentChange]);

            // Manejar pegado
            const handlePaste = useCallback((e) => {
                e.preventDefault();
                const text = e.clipboardData.getData('text/plain');
                
                // Insertar texto plano
                const selection = window.getSelection();
                if (!selection.rangeCount) return;
                
                selection.deleteFromDocument();
                const range = selection.getRangeAt(0);
                const textNode = document.createTextNode(text);
                range.insertNode(textNode);
                
                // Mover cursor al final del texto pegado
                range.setStartAfter(textNode);
                range.setEndAfter(textNode);
                selection.removeAllRanges();
                selection.addRange(range);
                
                handleContentChange();
            }, [handleContentChange]);

            // Manejar focus para asegurar estructura inicial
            const handleFocus = useCallback(() => {
                if (editorRef.current) {
                    const content = editorRef.current.innerHTML.trim();
                    if (content === '' || content === '<br>') {
                        editorRef.current.innerHTML = '<p><br></p>';
                        // Posicionar cursor al inicio
                        const selection = window.getSelection();
                        const range = document.createRange();
                        const p = editorRef.current.querySelector('p');
                        if (p) {
                            range.selectNodeContents(p);
                            range.collapse(true);
                            selection.removeAllRanges();
                            selection.addRange(range);
                        }
                    }
                }
                updateActiveFormats();
            }, [updateActiveFormats]);

            // Manejar input con throttle
            const handleInput = useCallback(() => {
                handleContentChange();
            }, [handleContentChange]);

            // Formatear como encabezado
            const formatHeading = useCallback((level) => {
                applyFormat('formatBlock', `<h${level}>`);
            }, [applyFormat]);

            // Aplicar formato de pÃ¡rrafo
            const formatParagraph = useCallback(() => {
                applyFormat('formatBlock', '<p>');
            }, [applyFormat]);

            return (
                <div className="editor-container">
                    <div className="editor-toolbar">
                        <button
                            type="button"
                            onClick={() => applyFormat('bold')}
                            className={`editor-btn ${activeFormats.bold ? 'active' : ''}`}
                            title="Negrita (Ctrl+B)"
                        >
                            <Icons.Bold />
                        </button>
                        <button
                            type="button"
                            onClick={() => applyFormat('italic')}
                            className={`editor-btn ${activeFormats.italic ? 'active' : ''}`}
                            title="Cursiva (Ctrl+I)"
                        >
                            <Icons.Italic />
                        </button>
                        <button
                            type="button"
                            onClick={() => applyFormat('underline')}
                            className={`editor-btn ${activeFormats.underline ? 'active' : ''}`}
                            title="Subrayado (Ctrl+U)"
                        >
                            <Icons.Underline />
                        </button>
                        <div className="divider-vertical" />
                        <button
                            type="button"
                            onClick={() => applyFormat('insertUnorderedList')}
                            className="editor-btn"
                            title="Lista"
                        >
                            <Icons.List />
                        </button>
                        <button
                            type="button"
                            onClick={() => applyFormat('insertOrderedList')}
                            className="editor-btn"
                            title="Lista numerada"
                        >
                            <Icons.ListOrdered />
                        </button>
                        <div className="divider-vertical" />
                        <button
                            type="button"
                            onClick={() => applyFormat('formatBlock', '<blockquote>')}
                            className="editor-btn"
                            title="Cita"
                        >
                            <Icons.Quote />
                        </button>
                        <div className="divider-vertical" />
                        <select
                            onChange={(e) => {
                                if (e.target.value === 'p') {
                                    formatParagraph();
                                } else if (e.target.value) {
                                    formatHeading(e.target.value);
                                }
                                e.target.value = '';
                            }}
                            className="bg-gray-700 text-white text-sm rounded-lg px-3 py-1 outline-none"
                            defaultValue=""
                        >
                            <option value="">Formato</option>
                            <option value="1">TÃ­tulo 1</option>
                            <option value="2">TÃ­tulo 2</option>
                            <option value="3">TÃ­tulo 3</option>
                            <option value="p">PÃ¡rrafo</option>
                        </select>
                    </div>
                    <div
                        ref={editorRef}
                        className="editor-content"
                        contentEditable
                        onInput={handleInput}
                        onKeyDown={handleKeyDown}
                        onPaste={handlePaste}
                        onFocus={handleFocus}
                        onSelect={updateActiveFormats}
                        onMouseUp={updateActiveFormats}
                        onBlur={handleContentChange}
                        data-placeholder={placeholder}
                        suppressContentEditableWarning={true}
                    />
                </div>
            );
        });

        // Componente CustomSelect optimizado
        const CustomSelect = memo(({ value, onChange, options, placeholder = "Seleccionar..." }) => {
            const [isOpen, setIsOpen] = useState(false);
            const selectRef = useRef(null);

            useEffect(() => {
                const handleClickOutside = (e) => {
                    if (selectRef.current && !selectRef.current.contains(e.target)) {
                        setIsOpen(false);
                    }
                };

                if (isOpen) {
                    document.addEventListener('mousedown', handleClickOutside);
                    return () => document.removeEventListener('mousedown', handleClickOutside);
                }
            }, [isOpen]);

            const selectedOption = options.find(opt => opt.value === value);

            return (
                <div ref={selectRef} className={`custom-select ${isOpen ? 'open' : ''}`}>
                    <div 
                        className="custom-select-trigger"
                        onClick={() => setIsOpen(!isOpen)}
                    >
                        <span>{selectedOption ? selectedOption.label : placeholder}</span>
                        <Icons.ChevronDown 
                            className="w-4 h-4 transition-transform" 
                            style={{
                                transform: isOpen ? 'rotate(180deg)' : 'rotate(0deg)'
                            }} 
                        />
                    </div>
                    <div className="custom-select-dropdown">
                        {options.map(option => (
                            <div
                                key={option.value}
                                className={`custom-select-option ${value === option.value ? 'selected' : ''}`}
                                onClick={() => {
                                    onChange(option.value);
                                    setIsOpen(false);
                                }}
                            >
                                {option.label}
                            </div>
                        ))}
                    </div>
                </div>
            );
        });

        // EmptyState optimizado
        const EmptyState = memo(({ type, onAdd }) => {
            const config = {
                locations: { icon: Icons.MapPin, text: 'No hay lugares creados', description: 'Los lugares dan vida a tu mundo' },
                players: { icon: Icons.Users, text: 'No hay jugadores creados', description: 'AÃ±ade a los hÃ©roes de tu historia' },
                npcs: { icon: Icons.User, text: 'No hay NPCs creados', description: 'Crea personajes memorables' },
                objects: { icon: Icons.Package, text: 'No hay objetos creados', description: 'AÃ±ade tesoros y artefactos' },
                quests: { icon: Icons.Scroll, text: 'No hay misiones creadas', description: 'Las aventuras esperan ser escritas' },
                notes: { icon: Icons.StickyNote, text: 'No hay notas creadas', description: 'Guarda tus ideas importantes' }
            };

            const { icon: IconComponent, text, description } = config[type] || {};

            return (
                <div className="empty-state">
                    <div className="empty-state-icon">
                        {IconComponent && <IconComponent />}
                    </div>
                    <h3 className="text-2xl font-bold text-gray-400 mb-2">{text}</h3>
                    <p className="text-gray-500 mb-6">{description}</p>
                    <button onClick={onAdd} className="btn-primary">
                        <Icons.Plus />
                        Crear el primero
                    </button>
                </div>
            );
        });

        // SearchDropdown optimizado
        const SearchDropdown = memo(({ searchTerm, results, onItemClick, onClose }) => {
            if (!searchTerm || results.length === 0) return null;

            return (
                <div className="search-dropdown">
                    {results.map(result => (
                        <div
                            key={`${result.type}-${result.id}`}
                            className="search-result-item"
                            onClick={() => {
                                onItemClick(result, result.type);
                                onClose();
                            }}
                        >
                            <span className="text-2xl">{result.icon || result.avatar || 'ğŸ“‹'}</span>
                            <div className="flex-1">
                                <p className="text-white font-semibold">
                                    {result.name || result.title}
                                </p>
                                <p className="text-gray-400 text-sm">
                                    {result.type || result.role || result.class || result.status}
                                </p>
                            </div>
                            <span className="search-result-type">
                                {result.type === 'locations' ? 'LUGAR' :
                                 result.type === 'players' ? 'JUGADOR' :
                                 result.type === 'npcs' ? 'NPC' :
                                 result.type === 'objects' ? 'OBJETO' : 
                                 result.type === 'quests' ? 'MISIÃ“N' : 'NOTA'}
                            </span>
                        </div>
                    ))}
                </div>
            );
        });

        // ItemCard optimizado con contain
        const ItemCard = memo(({ item, type, onClick }) => {
            const linkedCount = item.linkedItems ? 
                Object.values(item.linkedItems).flat().length : 0;

            return (
                <div 
                    className="card cursor-pointer fade-in"
                    onClick={() => onClick(item, type)}
                >
                    {linkedCount > 0 && (
                        <div className="connection-indicator">
                            {linkedCount}
                        </div>
                    )}
                    
                    <div className="flex items-start justify-between mb-4">
                        <div className="flex items-center">
                            <span className="text-4xl mr-4">{item.icon || item.avatar || 'ğŸ“‹'}</span>
                            <div>
                                <h3 className="text-xl font-bold text-white">
                                    {item.name || item.title || 'Sin nombre'}
                                </h3>
                                <p className="text-gray-400 text-sm">
                                    {item.type || item.role || item.class || item.status || ''}
                                </p>
                            </div>
                        </div>
                        
                        {(item.priority || item.importance || item.attitude || item.rarity || (item.status && type === 'quests')) && (
                            <div className="flex flex-col items-end gap-1">
                                {item.priority && (
                                    <span className={`badge ${getPriorityColor(item.priority)}`}>
                                        {item.priority}
                                    </span>
                                )}
                                {item.importance && (
                                    <span className={`badge ${getPriorityColor(item.importance)}`}>
                                        {item.importance}
                                    </span>
                                )}
                                {item.rarity && (
                                    <span className={`badge ${getRarityColor(item.rarity)}`}>
                                        {item.rarity}
                                    </span>
                                )}
                                {item.attitude && (
                                    <span className={`text-sm font-semibold ${getAttitudeColor(item.attitude)}`}>
                                        {item.attitude}
                                    </span>
                                )}
                                {item.status && type === 'quests' && (
                                    <span className={`text-sm font-semibold ${getStatusColor(item.status)}`}>
                                        {item.status}
                                    </span>
                                )}
                            </div>
                        )}
                    </div>
                    
                    <p className="text-gray-300 mb-4 line-clamp-3">
                        {item.description || 'Sin descripciÃ³n'}
                    </p>
                    
                    {item.tags && item.tags.length > 0 && (
                        <div className="flex flex-wrap gap-2 mb-4">
                            {item.tags.slice(0, 3).map((tag, idx) => (
                                <span key={`${tag}-${idx}`} className="text-xs bg-gray-700 text-gray-300 px-2 py-1 rounded">
                                    {tag}
                                </span>
                            ))}
                            {item.tags.length > 3 && (
                                <span className="text-xs bg-gray-700 text-gray-300 px-2 py-1 rounded">
                                    +{item.tags.length - 3}
                                </span>
                            )}
                        </div>
                    )}

                    {type === 'quests' && (
                        <div className="space-y-1 text-sm text-gray-400">
                            {item.location && (
                                <div className="flex items-center">
                                    <Icons.MapPin className="mr-2 w-4 h-4" />
                                    <span>{item.location}</span>
                                </div>
                            )}
                            {item.reward && (
                                <div className="flex items-center">
                                    <Icons.Star className="mr-2 w-4 h-4" />
                                    <span>{item.reward}</span>
                                </div>
                            )}
                        </div>
                    )}

                    {type === 'objects' && (
                        <div className="space-y-1 text-sm text-gray-400">
                            {item.owner && (
                                <div className="flex items-center">
                                    <Icons.User className="mr-2 w-4 h-4" />
                                    <span>{item.owner}</span>
                                </div>
                            )}
                            {item.location && (
                                <div className="flex items-center">
                                    <Icons.MapPin className="mr-2 w-4 h-4" />
                                    <span>{item.location}</span>
                                </div>
                            )}
                        </div>
                    )}
                </div>
            );
        });

        // ItemList optimizado
        const ItemList = memo(({ items, type, title, Icon, colorClass, onItemClick, onAddNew, searchTerm }) => {
            const filteredItems = useMemo(() => {
                if (!searchTerm) return items;
                const term = searchTerm.toLowerCase();
                return items.filter(item => {
                    const name = (item.name || item.title || '').toLowerCase();
                    const description = (item.description || '').toLowerCase();
                    return name.includes(term) || description.includes(term);
                });
            }, [items, searchTerm]);

            return (
                <div className="space-y-6 fade-in contain-layout">
                    <div className="flex justify-between items-center mb-8">
                        <h2 className="text-4xl font-bold text-white flex items-center">
                            <span className={`mr-4 ${colorClass}`}>
                                <Icon />
                            </span>
                            {title}
                        </h2>
                        <button
                            onClick={() => onAddNew(type)}
                            className="btn-primary"
                        >
                            <Icons.Plus />
                            AÃ±adir
                        </button>
                    </div>

                    {items.length === 0 ? (
                        <EmptyState type={type} onAdd={() => onAddNew(type)} />
                    ) : filteredItems.length === 0 ? (
                        <div className="text-center py-20">
                            <p className="text-gray-500 text-xl">No se encontraron resultados para "{searchTerm}"</p>
                        </div>
                    ) : (
                        <div className="responsive-grid">
                            {filteredItems.map((item) => (
                                <ItemCard
                                    key={item.id}
                                    item={item}
                                    type={type}
                                    onClick={onItemClick}
                                />
                            ))}
                        </div>
                    )}
                </div>
            );
        });

        // Componente principal de la aplicaciÃ³n
        const DnDCampaignManager = () => {
            // Estados principales
            const [view, setView] = useState('selector');
            const [campaigns, setCampaigns] = useState([]);
            const [currentCampaignId, setCurrentCampaignId] = useState(null);
            const [activeTab, setActiveTab] = useState('dashboard');
            
            // Estados de formularios y modales
            const [showForm, setShowForm] = useState(false);
            const [formType, setFormType] = useState('');
            const [isEditing, setIsEditing] = useState(false);
            const [newItem, setNewItem] = useState({});
            const [showDetailModal, setShowDetailModal] = useState(false);
            const [detailItem, setDetailItem] = useState(null);
            const [detailType, setDetailType] = useState('');
            const [showNewCampaignModal, setShowNewCampaignModal] = useState(false);
            const [newCampaignName, setNewCampaignName] = useState('');
            const [newCampaignDescription, setNewCampaignDescription] = useState('');
            
            // Estados de bÃºsqueda
            const [searchTerm, setSearchTerm] = useState('');
            const [showSearchDropdown, setShowSearchDropdown] = useState(false);
            
            // Estados de conexiones
            const [showConnectionModal, setShowConnectionModal] = useState(false);
            const [connectionSource, setConnectionSource] = useState(null);
            
            // Estados de emojis
            const [showEmojiPicker, setShowEmojiPicker] = useState(false);
            const [emojiTarget, setEmojiTarget] = useState(null);
            const [selectedEmojiCategory, setSelectedEmojiCategory] = useState('personas');
            
            // Estados de notas
            const [showNoteForm, setShowNoteForm] = useState(false);
            const [newNote, setNewNote] = useState({
                title: '',
                content: '',
                linkedItems: { locations: [], players: [], npcs: [], quests: [], objects: [] }
            });
            const [editingNote, setEditingNote] = useState(null);

            // Referencias
            const searchInputRef = useRef(null);

            // CampaÃ±a actual normalizada
            const currentCampaign = useMemo(() => {
                if (!currentCampaignId) return null;
                const campaign = campaigns.find(c => c.id === currentCampaignId);
                return campaign ? normalizeCampaign(campaign) : null;
            }, [campaigns, currentCampaignId]);

            // InicializaciÃ³n optimizada
            useEffect(() => {
                // Cargar campaÃ±as
                const savedCampaigns = loadCampaigns();
                if (savedCampaigns.length > 0) {
                    setCampaigns(savedCampaigns);
                }

                // Inicializar partÃ­culas con mejor performance
                const particlesContainer = document.getElementById('particles');
                if (particlesContainer && particlesContainer.children.length === 0) {
                    const fragment = document.createDocumentFragment();
                    for (let i = 0; i < 15; i++) { // Reducido para mejor performance
                        const particle = document.createElement('div');
                        particle.className = 'particle';
                        particle.style.width = Math.random() * 6 + 2 + 'px';
                        particle.style.height = particle.style.width;
                        particle.style.left = Math.random() * 100 + '%';
                        particle.style.animationDelay = Math.random() * 25 + 's';
                        particle.style.animationDuration = (Math.random() * 20 + 15) + 's';
                        fragment.appendChild(particle);
                    }
                    particlesContainer.appendChild(fragment);
                }
            }, []);

            // Guardar campaÃ±as cuando cambien
            useEffect(() => {
                if (campaigns.length > 0) {
                    saveCampaigns(campaigns);
                }
            }, [campaigns]);

            // Funciones de localStorage
            const loadCampaigns = () => {
                try {
                    const saved = localStorage.getItem('dndCampaigns');
                    if (!saved) return [];
                    const campaigns = JSON.parse(saved);
                    return campaigns.map(normalizeCampaign);
                } catch (e) {
                    console.error('Error loading campaigns:', e);
                    return [];
                }
            };

            const saveCampaigns = (campaignsToSave) => {
                try {
                    localStorage.setItem('dndCampaigns', JSON.stringify(campaignsToSave));
                } catch (e) {
                    console.error('Error saving campaigns:', e);
                    alert('Error al guardar las campaÃ±as. El almacenamiento local puede estar lleno.');
                }
            };

            // Funciones principales optimizadas
            const createNewCampaign = useCallback(() => {
                if (!newCampaignName.trim()) {
                    alert('Por favor ingresa un nombre para la campaÃ±a');
                    return;
                }

                const newCampaign = {
                    ...createEmptyCampaignStructure(),
                    id: generateId(),
                    name: newCampaignName,
                    description: newCampaignDescription,
                    createdAt: new Date().toISOString(),
                    lastModified: new Date().toISOString()
                };

                setCampaigns(prev => [...prev, newCampaign]);
                setCurrentCampaignId(newCampaign.id);
                setView('campaign');
                setActiveTab('dashboard');
                setShowNewCampaignModal(false);
                setNewCampaignName('');
                setNewCampaignDescription('');
            }, [newCampaignName, newCampaignDescription]);

            const updateCurrentCampaign = useCallback((updates) => {
                setCampaigns(prevCampaigns => prevCampaigns.map(c => 
                    c.id === currentCampaignId 
                        ? normalizeCampaign({ ...c, ...updates, lastModified: new Date().toISOString() })
                        : c
                ));
            }, [currentCampaignId]);

            const handleAddNew = useCallback((type) => {
                setFormType(type);
                setShowForm(true);
                setIsEditing(false);
                
                const defaultValues = {
                    locations: { icon: 'ğŸ›ï¸', importance: 'Media' },
                    players: { avatar: 'âš”ï¸' },
                    npcs: { icon: 'ğŸ‘¤', attitude: 'Neutral' },
                    quests: { icon: 'ğŸ“œ', status: 'Pendiente', priority: 'Media' },
                    objects: { icon: 'ğŸ’', rarity: 'ComÃºn' }
                };
                
                setNewItem({
                    id: generateId(),
                    tags: [],
                    linkedItems: { locations: [], players: [], npcs: [], quests: [], objects: [] },
                    ...(defaultValues[type] || {})
                });
            }, []);

            const handleSave = useCallback(() => {
                if (!currentCampaign) return;
                
                const updates = { ...currentCampaign };
                const itemToSave = normalizeItem(newItem);
                
                if (isEditing) {
                    updates[formType] = updates[formType].map(item => 
                        item.id === itemToSave.id ? itemToSave : item
                    );
                } else {
                    updates[formType] = [...updates[formType], itemToSave];
                }
                
                updateCurrentCampaign(updates);
                
                if (isEditing && showDetailModal) {
                    setDetailItem(itemToSave);
                }
                
                setShowForm(false);
                setNewItem({});
            }, [currentCampaign, isEditing, formType, newItem, updateCurrentCampaign, showDetailModal]);

            const handleItemClick = useCallback((item, type) => {
                setDetailItem(item);
                setDetailType(type);
                setShowDetailModal(true);
            }, []);

            const handleSaveNote = useCallback(() => {
                if (!currentCampaign || !newNote.content.trim()) return;

                const updates = { ...currentCampaign };
                
                if (editingNote) {
                    updates.notes = updates.notes.map(note => 
                        note.id === editingNote.id 
                            ? { ...normalizeItem(newNote), id: editingNote.id, modifiedAt: new Date().toISOString() }
                            : note
                    );
                } else {
                    const newNoteObj = normalizeItem({
                        ...newNote,
                        createdAt: new Date().toISOString()
                    });
                    updates.notes = [...updates.notes, newNoteObj];
                }
                
                updateCurrentCampaign(updates);
                
                if (editingNote && showDetailModal) {
                    const savedNote = editingNote ? { ...normalizeItem(newNote), id: editingNote.id } : null;
                    if (savedNote) {
                        setDetailItem(savedNote);
                    }
                }
                
                setShowNoteForm(false);
                setNewNote({
                    title: '',
                    content: '',
                    linkedItems: { locations: [], players: [], npcs: [], quests: [], objects: [] }
                });
                setEditingNote(null);
            }, [currentCampaign, newNote, editingNote, updateCurrentCampaign, showDetailModal]);

            const createConnection = useCallback((sourceItem, sourceType, targetItem, targetType) => {
                if (!currentCampaign) return;

                const updates = { ...currentCampaign };

                // Actualizar item fuente
                const sourceItems = [...updates[sourceType]];
                const sourceIndex = sourceItems.findIndex(item => item.id === sourceItem.id);
                if (sourceIndex !== -1) {
                    if (!sourceItems[sourceIndex].linkedItems) {
                        sourceItems[sourceIndex].linkedItems = {};
                    }
                    if (!sourceItems[sourceIndex].linkedItems[targetType]) {
                        sourceItems[sourceIndex].linkedItems[targetType] = [];
                    }
                    if (!sourceItems[sourceIndex].linkedItems[targetType].includes(targetItem.id)) {
                        sourceItems[sourceIndex].linkedItems[targetType].push(targetItem.id);
                    }
                    updates[sourceType] = sourceItems;
                }

                // Actualizar item destino
                const targetItems = [...updates[targetType]];
                const targetIndex = targetItems.findIndex(item => item.id === targetItem.id);
                if (targetIndex !== -1) {
                    if (!targetItems[targetIndex].linkedItems) {
                        targetItems[targetIndex].linkedItems = {};
                    }
                    if (!targetItems[targetIndex].linkedItems[sourceType]) {
                        targetItems[targetIndex].linkedItems[sourceType] = [];
                    }
                    if (!targetItems[targetIndex].linkedItems[sourceType].includes(sourceItem.id)) {
                        targetItems[targetIndex].linkedItems[sourceType].push(sourceItem.id);
                    }
                    updates[targetType] = targetItems;
                }

                updateCurrentCampaign(updates);
                
                if (showDetailModal && detailItem.id === sourceItem.id) {
                    setDetailItem(sourceItems[sourceIndex]);
                }
            }, [currentCampaign, updateCurrentCampaign, showDetailModal, detailItem]);

            const removeConnection = useCallback((sourceItem, sourceType, targetItem, targetType) => {
                if (!currentCampaign) return;

                const updates = { ...currentCampaign };

                // Remover del item fuente
                const sourceItems = [...updates[sourceType]];
                const sourceIndex = sourceItems.findIndex(item => item.id === sourceItem.id);
                if (sourceIndex !== -1 && sourceItems[sourceIndex].linkedItems?.[targetType]) {
                    sourceItems[sourceIndex].linkedItems[targetType] = 
                        sourceItems[sourceIndex].linkedItems[targetType].filter(id => id !== targetItem.id);
                    updates[sourceType] = sourceItems;
                }

                // Remover del item destino
                const targetItems = [...updates[targetType]];
                const targetIndex = targetItems.findIndex(item => item.id === targetItem.id);
                if (targetIndex !== -1 && targetItems[targetIndex].linkedItems?.[sourceType]) {
                    targetItems[targetIndex].linkedItems[sourceType] = 
                        targetItems[targetIndex].linkedItems[sourceType].filter(id => id !== sourceItem.id);
                    updates[targetType] = targetItems;
                }

                updateCurrentCampaign(updates);
                
                if (showDetailModal && detailItem.id === sourceItem.id) {
                    setDetailItem(sourceItems[sourceIndex]);
                }
            }, [currentCampaign, updateCurrentCampaign, showDetailModal, detailItem]);

            const searchAllItems = useCallback(() => {
                if (!currentCampaign || !searchTerm) return [];
                
                const term = searchTerm.toLowerCase();
                const results = [];

                ['locations', 'players', 'npcs', 'quests', 'objects', 'notes'].forEach(type => {
                    const items = currentCampaign[type] || [];
                    items.forEach(item => {
                        const name = (item.name || item.title || '').toLowerCase();
                        const description = (item.description || '').toLowerCase();
                        if (name.includes(term) || description.includes(term)) {
                            results.push({ ...item, type });
                        }
                    });
                });

                return results.slice(0, 10); // Limitar resultados para mejor performance
            }, [currentCampaign, searchTerm]);

            const exportCampaign = useCallback((campaignId) => {
                const campaign = campaigns.find(c => c.id === campaignId);
                if (campaign) {
                    const dataStr = JSON.stringify(campaign, null, 2);
                    const dataBlob = new Blob([dataStr], { type: 'application/json' });
                    const url = URL.createObjectURL(dataBlob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `${campaign.name.replace(/[^a-z0-9]/gi, '_')}_${new Date().toISOString().split('T')[0]}.json`;
                    link.click();
                    URL.revokeObjectURL(url);
                }
            }, [campaigns]);

            // Componentes internos

            // Modal de conexiones optimizado
            const ConnectionModal = ({ sourceItem, sourceType, onClose }) => {
                const [selectedByType, setSelectedByType] = useState({});
                const [activeType, setActiveType] = useState('locations');

                useEffect(() => {
                    if (sourceType === 'notes') {
                        // Inicializar con las conexiones existentes
                        const existing = {};
                        Object.entries(sourceItem.linkedItems || {}).forEach(([type, ids]) => {
                            existing[type] = ids.map(id => 
                                currentCampaign?.[type]?.find(item => item.id === id)
                            ).filter(Boolean);
                        });
                        setSelectedByType(existing);
                    }
                }, [sourceItem, sourceType]);

                const availableTypes = {
                    locations: { name: 'Lugares', icon: Icons.MapPin },
                    players: { name: 'Jugadores', icon: Icons.Users },
                    npcs: { name: 'NPCs', icon: Icons.User },
                    quests: { name: 'Misiones', icon: Icons.Scroll },
                    objects: { name: 'Objetos', icon: Icons.Package }
                };

                const getAvailableItems = useCallback((type) => {
                    if (!currentCampaign) return [];
                    
                    const campaignItems = currentCampaign[type] || [];
                    
                    if (sourceType === 'notes') {
                        // Para notas, excluir los que ya estÃ¡n en selectedByType
                        const selectedIds = selectedByType[type]?.map(item => item.id) || [];
                        return campaignItems.filter(item => !selectedIds.includes(item.id));
                    }
                    
                    return campaignItems.filter(item => {
                        if (type === sourceType && item.id === sourceItem.id) return false;
                        const existingLinks = sourceItem.linkedItems?.[type] || [];
                        return !existingLinks.includes(item.id);
                    });
                }, [currentCampaign, sourceType, sourceItem, selectedByType]);

                const handleConnect = useCallback(() => {
                    if (sourceType === 'notes') {
                        const updatedNote = {
                            ...sourceItem,
                            linkedItems: {}
                        };
                        
                        // Convertir selectedByType a formato de IDs
                        Object.entries(selectedByType).forEach(([type, items]) => {
                            updatedNote.linkedItems[type] = items.map(item => item.id);
                        });
                        
                        setNewNote(updatedNote);
                        
                        // Si estamos en el modal de detalle, actualizar
                        if (showDetailModal && detailItem.id === sourceItem.id) {
                            setDetailItem(updatedNote);
                        }
                    } else {
                        // Para otros tipos, conectar todos los seleccionados
                        Object.entries(selectedByType).forEach(([type, items]) => {
                            items.forEach(item => {
                                createConnection(sourceItem, sourceType, item, type);
                            });
                        });
                    }
                    onClose();
                }, [sourceType, sourceItem, selectedByType, onClose]);

                const toggleItemSelection = useCallback((item, type) => {
                    setSelectedByType(prev => {
                        const typeItems = prev[type] || [];
                        const isSelected = typeItems.some(i => i.id === item.id);
                        
                        if (isSelected) {
                            return {
                                ...prev,
                                [type]: typeItems.filter(i => i.id !== item.id)
                            };
                        } else {
                            return {
                                ...prev,
                                [type]: [...typeItems, item]
                            };
                        }
                    });
                }, []);

                const selectAllInType = useCallback((type) => {
                    const availableItems = getAvailableItems(type);
                    const currentSelected = selectedByType[type] || [];
                    
                    if (currentSelected.length === availableItems.length + (sourceType === 'notes' ? currentSelected.length : 0)) {
                        // Deseleccionar todos
                        setSelectedByType(prev => ({
                            ...prev,
                            [type]: []
                        }));
                    } else {
                        // Seleccionar todos disponibles
                        setSelectedByType(prev => ({
                            ...prev,
                            [type]: sourceType === 'notes' 
                                ? [...availableItems, ...currentSelected]
                                : availableItems
                        }));
                    }
                }, [getAvailableItems, selectedByType, sourceType]);

                const getTotalSelected = useCallback(() => {
                    return Object.values(selectedByType).flat().length;
                }, [selectedByType]);

                const availableItems = getAvailableItems(activeType);
                const selectedInType = selectedByType[activeType] || [];

                return (
                    <div className="modal-backdrop">
                        <div className="modal-content glass max-w-2xl w-full">
                            <div className="modal-header">
                                <div className="flex justify-between items-center">
                                    <div>
                                        <h3 className="text-2xl font-bold text-white">
                                            {sourceType === 'notes' ? 'Vincular elementos' : 'Crear Conexiones'}
                                        </h3>
                                        <p className="text-gray-400 mt-1">
                                            {sourceType === 'notes' ? 'Selecciona elementos para vincular con esta nota' : 
                                             `Conectar con: ${sourceItem.name || sourceItem.title}`}
                                        </p>
                                    </div>
                                    <button
                                        onClick={onClose}
                                        className="btn-secondary p-2"
                                    >
                                        <Icons.X />
                                    </button>
                                </div>
                            </div>
                            
                            <div className="modal-body">
                                <div className="mb-6">
                                    <label className="field-label mb-3">Tipo de elemento</label>
                                    <div className="tab-pills">
                                        {Object.entries(availableTypes).map(([key, type]) => {
                                            const IconComponent = type.icon;
                                            const count = selectedByType[key]?.length || 0;
                                            return (
                                                <button
                                                    key={key}
                                                    onClick={() => setActiveType(key)}
                                                    className={`tab-pill ${activeType === key ? 'active' : ''}`}
                                                >
                                                    <IconComponent className="w-4 h-4 mr-2" />
                                                    {type.name}
                                                    {count > 0 && (
                                                        <span className="ml-2 bg-purple-600 text-white px-2 py-0.5 rounded-full text-xs">
                                                            {count}
                                                        </span>
                                                    )}
                                                </button>
                                            );
                                        })}
                                    </div>
                                </div>

                                <div>
                                    <div className="flex items-center justify-between mb-4">
                                        <label className="field-label">
                                            {TAB_CONFIG[activeType]?.name} ({availableItems.length + selectedInType.length})
                                        </label>
                                        {(availableItems.length > 0 || selectedInType.length > 0) && (
                                            <button
                                                onClick={() => selectAllInType(activeType)}
                                                className="text-sm text-purple-400 hover:text-purple-300"
                                            >
                                                {selectedInType.length === availableItems.length + selectedInType.length
                                                    ? 'Deseleccionar todos' 
                                                    : 'Seleccionar todos'}
                                            </button>
                                        )}
                                    </div>
                                    
                                    {availableItems.length === 0 && selectedInType.length === 0 ? (
                                        <div className="text-center py-12 text-gray-500">
                                            No hay elementos disponibles de este tipo
                                        </div>
                                    ) : (
                                        <div className="space-y-2 max-h-96 overflow-y-auto">
                                            {/* Mostrar primero los ya seleccionados */}
                                            {sourceType === 'notes' && selectedInType.map(item => (
                                                <div
                                                    key={item.id}
                                                    className="p-4 rounded-lg border-2 cursor-pointer transition-all border-purple-500 bg-purple-500 bg-opacity-20"
                                                    onClick={() => toggleItemSelection(item, activeType)}
                                                >
                                                    <div className="flex items-center">
                                                        <span className="text-3xl mr-4">
                                                            {item.icon || item.avatar || 'ğŸ“‹'}
                                                        </span>
                                                        <div className="flex-1">
                                                            <h4 className="text-white font-semibold">
                                                                {item.name || item.title}
                                                            </h4>
                                                            <p className="text-gray-400 text-sm">
                                                                {item.type || item.role || item.status}
                                                            </p>
                                                        </div>
                                                        <Icons.CheckSquare className="w-5 h-5 text-purple-400" />
                                                    </div>
                                                </div>
                                            ))}
                                            
                                            {/* Mostrar los disponibles */}
                                            {availableItems.map(item => {
                                                const isSelected = selectedInType.some(i => i.id === item.id);
                                                return (
                                                    <div
                                                        key={item.id}
                                                        className={`p-4 rounded-lg border-2 cursor-pointer transition-all ${
                                                            isSelected
                                                                ? 'border-purple-500 bg-purple-500 bg-opacity-20'
                                                                : 'border-gray-700 hover:border-gray-600 glass-light'
                                                        }`}
                                                        onClick={() => toggleItemSelection(item, activeType)}
                                                    >
                                                        <div className="flex items-center">
                                                            <span className="text-3xl mr-4">
                                                                {item.icon || item.avatar || 'ğŸ“‹'}
                                                            </span>
                                                            <div className="flex-1">
                                                                <h4 className="text-white font-semibold">
                                                                    {item.name || item.title}
                                                                </h4>
                                                                <p className="text-gray-400 text-sm">
                                                                    {item.type || item.role || item.status}
                                                                </p>
                                                            </div>
                                                            {isSelected && (
                                                                <Icons.CheckSquare className="w-5 h-5 text-purple-400" />
                                                            )}
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    )}
                                </div>
                            </div>

                            <div className="modal-footer flex justify-between items-center">
                                <div className="text-sm text-gray-400">
                                    Total seleccionados: <span className="text-white font-bold">{getTotalSelected()}</span>
                                </div>
                                <div className="flex gap-4">
                                    <button onClick={onClose} className="btn-secondary">
                                        Cancelar
                                    </button>
                                    <button
                                        onClick={handleConnect}
                                        disabled={getTotalSelected() === 0}
                                        className="btn-primary"
                                    >
                                        <Icons.Link2 />
                                        {sourceType === 'notes' ? 'Vincular' : 'Conectar'} ({getTotalSelected()})
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            // Selector de emojis optimizado
            const EmojiPicker = memo(({ onSelect, onClose }) => {
                const [visibleEmojis, setVisibleEmojis] = useState([]);
                const containerRef = useRef(null);

                // Cargar emojis con lazy loading
                useEffect(() => {
                    const emojis = EMOJI_CATEGORIES[selectedEmojiCategory].emojis;
                    // Cargar primeros 30 inmediatamente
                    setVisibleEmojis(emojis.slice(0, 30));
                    
                    // Cargar el resto despuÃ©s de un pequeÃ±o delay
                    if (emojis.length > 30) {
                        const timeoutId = setTimeout(() => {
                            setVisibleEmojis(emojis);
                        }, 100);
                        
                        return () => clearTimeout(timeoutId);
                    }
                }, [selectedEmojiCategory]);

                return (
                    <div className="modal-backdrop">
                        <div className="modal-content glass max-w-md w-full">
                            <div className="modal-header">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-xl font-bold text-white">Seleccionar Emoji</h3>
                                    <button onClick={onClose} className="btn-secondary p-2">
                                        <Icons.X />
                                    </button>
                                </div>
                                <div className="tab-pills">
                                    {Object.entries(EMOJI_CATEGORIES).map(([key, category]) => (
                                        <button
                                            key={key}
                                            onClick={() => setSelectedEmojiCategory(key)}
                                            className={`tab-pill ${selectedEmojiCategory === key ? 'active' : ''}`}
                                        >
                                            {category.name}
                                        </button>
                                    ))}
                                </div>
                            </div>
                            <div ref={containerRef} className="emoji-grid">
                                {visibleEmojis.map((emoji, idx) => (
                                    <button
                                        key={`emoji-${selectedEmojiCategory}-${idx}`}
                                        className="emoji-button no-select"
                                        onClick={() => {
                                            onSelect(emoji);
                                            onClose();
                                        }}
                                    >
                                        {emoji}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>
                );
            });

            // Renderizado del selector de campaÃ±as
            const renderCampaignSelector = () => (
                <div className="min-h-screen gradient-bg p-6">
                    <div className="max-w-7xl mx-auto">
                        <div className="text-center mb-16 fade-in">
                            <div className="flex items-center justify-center mb-6">
                                <Icons.Sparkles className="w-12 h-12 text-purple-400 mr-4" />
                                <h1 className="text-6xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">
                                    Gestor de CampaÃ±as D&D
                                </h1>
                                <Icons.Sparkles className="w-12 h-12 text-purple-400 ml-4" />
                            </div>
                            <p className="text-gray-400 text-xl">
                                Crea mundos Ã©picos y vive aventuras inolvidables
                            </p>
                        </div>

                        <div className="flex justify-center gap-4 mb-12">
                            <button onClick={() => setShowNewCampaignModal(true)} className="btn-primary">
                                <Icons.Plus />
                                Nueva CampaÃ±a
                            </button>
                            <button
                                onClick={() => {
                                    const input = document.createElement('input');
                                    input.type = 'file';
                                    input.accept = '.json';
                                    input.onchange = (e) => {
                                        const file = e.target.files[0];
                                        if (file) {
                                            const reader = new FileReader();
                                            reader.onload = (event) => {
                                                try {
                                                    const campaign = JSON.parse(event.target.result);
                                                    const newCampaign = normalizeCampaign({
                                                        ...campaign,
                                                        id: generateId(),
                                                        lastModified: new Date().toISOString()
                                                    });
                                                    setCampaigns([...campaigns, newCampaign]);
                                                    alert('CampaÃ±a importada exitosamente');
                                                } catch (error) {
                                                    alert('Error al importar la campaÃ±a');
                                                    console.error(error);
                                                }
                                            };
                                            reader.readAsText(file);
                                        }
                                    };
                                    input.click();
                                }}
                                className="btn-secondary"
                            >
                                <Icons.Upload />
                                Importar
                            </button>
                        </div>

                        {campaigns.length === 0 ? (
                            <div className="text-center py-20 fade-in">
                                <div className="text-8xl mb-8 animate-bounce">ğŸ²</div>
                                <p className="text-gray-400 text-2xl mb-8">Â¡Tu aventura comienza aquÃ­!</p>
                                <button
                                    onClick={() => setShowNewCampaignModal(true)}
                                    className="btn-primary text-xl px-10 py-5"
                                >
                                    Crear tu Primera CampaÃ±a
                                </button>
                            </div>
                        ) : (
                            <div className="responsive-grid">
                                {campaigns.map((campaign, index) => (
                                    <div
                                        key={campaign.id}
                                        className="card cursor-pointer fade-in"
                                        style={{ animationDelay: `${index * 0.1}s` }}
                                        onClick={() => {
                                            setCurrentCampaignId(campaign.id);
                                            setView('campaign');
                                            setActiveTab('dashboard');
                                        }}
                                    >
                                        <div className="flex justify-between items-start mb-6">
                                            <h3 className="text-2xl font-bold text-white flex-1 pr-4">
                                                {campaign.name}
                                            </h3>
                                            <div className="flex gap-2" onClick={e => e.stopPropagation()}>
                                                <button
                                                    onClick={() => exportCampaign(campaign.id)}
                                                    className="btn-secondary p-2 tooltip"
                                                    data-tooltip="Exportar"
                                                >
                                                    <Icons.Download />
                                                </button>
                                                <button
                                                    onClick={() => {
                                                        if (confirm('Â¿EstÃ¡s seguro de que quieres eliminar esta campaÃ±a?')) {
                                                            setCampaigns(campaigns.filter(c => c.id !== campaign.id));
                                                        }
                                                    }}
                                                    className="btn-secondary p-2 text-red-400 hover:text-red-300 tooltip"
                                                    data-tooltip="Eliminar"
                                                >
                                                    <Icons.Trash2 />
                                                </button>
                                            </div>
                                        </div>
                                        
                                        <p className="text-gray-400 mb-6 line-clamp-2">
                                            {campaign.description || 'Una aventura Ã©pica te espera...'}
                                        </p>
                                        
                                        <div className="grid grid-cols-2 gap-4 text-sm mb-6">
                                            <div className="flex items-center text-blue-400">
                                                <Icons.MapPin className="mr-2 w-4 h-4" />
                                                <span>{campaign.locations?.length || 0} lugares</span>
                                            </div>
                                            <div className="flex items-center text-green-400">
                                                <Icons.Users className="mr-2 w-4 h-4" />
                                                <span>{campaign.players?.length || 0} jugadores</span>
                                            </div>
                                            <div className="flex items-center text-purple-400">
                                                <Icons.User className="mr-2 w-4 h-4" />
                                                <span>{campaign.npcs?.length || 0} NPCs</span>
                                            </div>
                                            <div className="flex items-center text-cyan-400">
                                                <Icons.Package className="mr-2 w-4 h-4" />
                                                <span>{campaign.objects?.length || 0} objetos</span>
                                            </div>
                                            <div className="flex items-center text-orange-400">
                                                <Icons.Scroll className="mr-2 w-4 h-4" />
                                                <span>{campaign.quests?.length || 0} misiones</span>
                                            </div>
                                            <div className="flex items-center text-blue-400">
                                                <Icons.StickyNote className="mr-2 w-4 h-4" />
                                                <span>{campaign.notes?.length || 0} notas</span>
                                            </div>
                                        </div>
                                        
                                        <div className="text-xs text-gray-500 pt-4 border-t border-gray-700">
                                            <div className="flex justify-between">
                                                <span>Creada: {new Date(campaign.createdAt).toLocaleDateString()}</span>
                                                <span>Actualizada: {new Date(campaign.lastModified).toLocaleDateString()}</span>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                </div>
            );

            // Renderizado del dashboard
            const renderDashboard = () => {
                if (!currentCampaign) return null;
                
                const stats = {
                    activeQuests: (currentCampaign.quests || []).filter(q => q.status === 'En progreso').length,
                    completedQuests: (currentCampaign.quests || []).filter(q => q.status === 'Completada').length
                };

                return (
                    <div className="space-y-8 fade-in contain-layout">
                        <div className="text-center mb-12">
                            <h1 className="campaign-title">
                                {currentCampaign.name}
                            </h1>
                            <p className="text-gray-400 text-lg">
                                {currentCampaign.description || 'Tu mundo de aventuras te espera'}
                            </p>
                        </div>

                        <div className="category-nav">
                            {TAB_ORDER.slice(1).map(tabKey => {
                                const config = TAB_CONFIG[tabKey];
                                const colorMap = {
                                    blue: { start: '#3b82f6', end: '#2563eb' },
                                    green: { start: '#10b981', end: '#059669' },
                                    purple: { start: '#8b5cf6', end: '#7c3aed' },
                                    orange: { start: '#f97316', end: '#ea580c' },
                                    cyan: { start: '#06b6d4', end: '#0891b2' }
                                };
                                const colors = colorMap[config.color];
                                
                                return (
                                    <button
                                        key={tabKey}
                                        onClick={() => setActiveTab(tabKey)}
                                        className={`category-button ${activeTab === tabKey ? 'active' : ''} text-${config.color}-400`}
                                        style={{ '--color-start': colors.start, '--color-end': colors.end }}
                                    >
                                        <div className="relative z-10">
                                            <config.icon className="w-12 h-12 mx-auto mb-3" />
                                            <h3 className="text-3xl font-bold mb-1">
                                                {(currentCampaign[tabKey] || []).length}
                                            </h3>
                                            <p className="text-sm opacity-80">{config.name}</p>
                                        </div>
                                    </button>
                                );
                            })}
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div className="stat-card">
                                <Icons.Target className="w-8 h-8 text-yellow-500 mx-auto" />
                                <div className="stat-value text-yellow-400">{stats.activeQuests}</div>
                                <div className="text-sm text-gray-400">Misiones Activas</div>
                            </div>
                            <div className="stat-card">
                                <Icons.Star className="w-8 h-8 text-green-500 mx-auto" />
                                <div className="stat-value text-green-400">{stats.completedQuests}</div>
                                <div className="text-sm text-gray-400">Completadas</div>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <div className="card">
                                <h2 className="text-2xl font-bold text-white mb-6 flex items-center">
                                    <Icons.Target className="mr-3 text-yellow-400" />
                                    Misiones Activas
                                </h2>
                                <div className="space-y-3 contain-layout">
                                    {(currentCampaign.quests || [])
                                        .filter(q => q.status === 'En progreso')
                                        .slice(0, 3)
                                        .map(quest => (
                                            <div 
                                                key={quest.id}
                                                className="glass-light rounded-lg p-4 cursor-pointer hover:bg-gray-700 transition-all"
                                                onClick={() => handleItemClick(quest, 'quests')}
                                            >
                                                <div className="flex items-center justify-between">
                                                    <div className="flex items-center flex-1">
                                                        <span className="text-3xl mr-4">{quest.icon || 'ğŸ“œ'}</span>
                                                        <div>
                                                            <h3 className="text-lg font-semibold text-white">
                                                                {quest.title}
                                                            </h3>
                                                            <p className="text-gray-400 text-sm">{quest.location}</p>
                                                        </div>
                                                    </div>
                                                    <span className={`badge ${getPriorityColor(quest.priority)}`}>
                                                        {quest.priority}
                                                    </span>
                                                </div>
                                            </div>
                                        ))}
                                    {(currentCampaign.quests || []).filter(q => q.status === 'En progreso').length === 0 && (
                                        <p className="text-gray-500 text-center py-8">No hay misiones activas</p>
                                    )}
                                </div>
                            </div>

                            <div className="card">
                                <div className="flex items-center justify-between mb-6">
                                    <h2 className="text-2xl font-bold text-white flex items-center">
                                        <Icons.StickyNote className="mr-3 text-blue-400" />
                                        Notas Recientes
                                    </h2>
                                    <button
                                        onClick={() => setActiveTab('notes')}
                                        className="btn-secondary p-2"
                                    >
                                        <Icons.ArrowLeft className="transform rotate-180" />
                                    </button>
                                </div>
                                <div className="space-y-3 max-h-64 overflow-y-auto">
                                    {(currentCampaign.notes || []).slice(0, 5).map(note => (
                                        <div 
                                            key={note.id} 
                                            className="note-card" 
                                            onClick={() => handleItemClick(note, 'notes')}
                                        >
                                            {note.title && (
                                                <h4 className="text-lg font-semibold text-white mb-1">
                                                    {note.title}
                                                </h4>
                                            )}
                                            <p className="text-xs text-gray-500 mb-2">
                                                {new Date(note.createdAt).toLocaleDateString()} - {new Date(note.createdAt).toLocaleTimeString()}
                                            </p>
                                            <div 
                                                className="text-gray-300 text-sm line-clamp-3 formatted-content"
                                                dangerouslySetInnerHTML={{ __html: note.content }}
                                            />
                                        </div>
                                    ))}
                                    {(currentCampaign.notes || []).length === 0 && (
                                        <p className="text-gray-500 text-center py-8">No hay notas en la campaÃ±a</p>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            // Renderizado de notas
            const renderNotes = () => {
                if (!currentCampaign) return null;
                
                const notes = currentCampaign.notes || [];
                
                return (
                    <div className="space-y-6 fade-in contain-layout">
                        <div className="flex justify-between items-center mb-8">
                            <h2 className="text-4xl font-bold text-white flex items-center">
                                <Icons.StickyNote className="mr-4 text-blue-400" />
                                Notas de CampaÃ±a
                            </h2>
                            <button
                                onClick={() => {
                                    setShowNoteForm(true);
                                    setEditingNote(null);
                                    setNewNote({
                                        title: '',
                                        content: '',
                                        linkedItems: { locations: [], players: [], npcs: [], quests: [], objects: [] }
                                    });
                                }}
                                className="btn-primary"
                            >
                                <Icons.Plus />
                                Nueva Nota
                            </button>
                        </div>

                        {notes.length === 0 ? (
                            <EmptyState 
                                type="notes" 
                                onAdd={() => {
                                    setShowNoteForm(true);
                                    setEditingNote(null);
                                    setNewNote({
                                        title: '',
                                        content: '',
                                        linkedItems: { locations: [], players: [], npcs: [], quests: [], objects: [] }
                                    });
                                }} 
                            />
                        ) : (
                            <div className="responsive-grid">
                                {notes.map((note, index) => (
                                    <div 
                                        key={note.id}
                                        className="card cursor-pointer fade-in"
                                        style={{ animationDelay: `${index * 0.05}s` }}
                                        onClick={() => handleItemClick(note, 'notes')}
                                    >
                                        <div className="mb-4">
                                            {note.title && (
                                                <h3 className="text-xl font-bold text-white mb-2">{note.title}</h3>
                                            )}
                                            <p className="text-xs text-gray-500 mb-2">
                                                {new Date(note.createdAt).toLocaleDateString()} - {new Date(note.createdAt).toLocaleTimeString()}
                                            </p>
                                            <div 
                                                className="text-gray-300 line-clamp-5 formatted-content"
                                                dangerouslySetInnerHTML={{ __html: note.content }}
                                            />
                                        </div>
                                        
                                        {note.linkedItems && Object.values(note.linkedItems).flat().length > 0 && (
                                            <div className="connection-indicator">
                                                {Object.values(note.linkedItems).flat().length}
                                            </div>
                                        )}
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                );
            };

            // Modal de detalles optimizado
            const renderDetailModal = () => {
                if (!detailItem || !detailType || !currentCampaign) return null;

                const getLinkedItems = (item) => {
                    if (!currentCampaign || !item.linkedItems) return {};
                    
                    const linked = {};
                    Object.entries(item.linkedItems).forEach(([linkedType, ids]) => {
                        linked[linkedType] = ids.map(id => 
                            currentCampaign[linkedType]?.find(i => i.id === id)
                        ).filter(Boolean);
                    });
                    
                    return linked;
                };

                const linkedItems = getLinkedItems(detailItem);
                const totalConnections = Object.values(linkedItems).flat().length;

                return (
                    <div className="modal-backdrop">
                        <div className="modal-content glass max-w-5xl w-full">
                            <div className="modal-header">
                                <div className="flex items-start justify-between">
                                    <div className="flex items-center">
                                        {detailType === 'notes' ? (
                                            <>
                                                <Icons.StickyNote className="w-12 h-12 text-blue-400 mr-4" />
                                                <div>
                                                    <h2 className="text-3xl font-bold text-white">
                                                        {detailItem.title || 'Nota sin tÃ­tulo'}
                                                    </h2>
                                                    <p className="text-gray-400 mt-1">
                                                        {new Date(detailItem.createdAt).toLocaleDateString()} - {new Date(detailItem.createdAt).toLocaleTimeString()}
                                                    </p>
                                                </div>
                                            </>
                                        ) : (
                                            <>
                                                <span className="text-5xl mr-4">
                                                    {detailItem.icon || detailItem.avatar || 'ğŸ“‹'}
                                                </span>
                                                <div>
                                                    <h2 className="text-3xl font-bold text-white">
                                                        {detailItem.name || detailItem.title}
                                                    </h2>
                                                    <p className="text-gray-400 mt-1">
                                                        {detailItem.type || detailItem.role || detailItem.class || 
                                                         (detailItem.status && `${detailItem.status} - Prioridad ${detailItem.priority}`)}
                                                    </p>
                                                </div>
                                            </>
                                        )}
                                    </div>
                                    <button onClick={() => setShowDetailModal(false)} className="btn-secondary p-2">
                                        <Icons.X />
                                    </button>
                                </div>
                            </div>

                            <div className="modal-body">
                                <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                                    <div className="lg:col-span-2 space-y-6">
                                        <div className="glass-light rounded-xl p-6">
                                            <h3 className="text-xl font-semibold text-white mb-4">
                                                {detailType === 'notes' ? 'Contenido' : 'DescripciÃ³n'}
                                            </h3>
                                            <div 
                                                className="text-gray-300 formatted-content"
                                                dangerouslySetInnerHTML={{ 
                                                    __html: detailType === 'notes' ? detailItem.content :
                                                            (detailItem.detailedDescription || detailItem.backstory || detailItem.description || 'Sin descripciÃ³n')
                                                }}
                                            />
                                        </div>

                                        {detailType !== 'notes' && renderDetailInfo()}
                                    </div>

                                    <div className="space-y-6">
                                        <div className="glass-light rounded-xl p-6">
                                            <div className="flex items-center justify-between mb-4">
                                                <h3 className="text-xl font-semibold text-white">
                                                    Conexiones ({totalConnections})
                                                </h3>
                                                {detailType !== 'notes' && (
                                                    <button
                                                        onClick={() => {
                                                            setConnectionSource({ item: detailItem, type: detailType });
                                                            setShowConnectionModal(true);
                                                        }}
                                                        className="btn-secondary p-2"
                                                    >
                                                        <Icons.Link2 />
                                                    </button>
                                                )}
                                            </div>
                                            
                                            {totalConnections > 0 ? (
                                                <div className="space-y-3 max-h-64 overflow-y-auto">
                                                    {Object.entries(linkedItems).map(([type, items]) => 
                                                        items.map(linked => (
                                                            <div 
                                                                key={`${type}-${linked.id}`}
                                                                className="glass-light rounded-lg p-3 flex items-center justify-between hover:bg-gray-700 transition-all cursor-pointer"
                                                                onClick={() => {
                                                                    setDetailItem(linked);
                                                                    setDetailType(type);
                                                                }}
                                                            >
                                                                <div className="flex items-center flex-1">
                                                                    <span className="text-2xl mr-3">
                                                                        {linked.icon || linked.avatar || 'ğŸ“‹'}
                                                                    </span>
                                                                    <div>
                                                                        <p className="text-white text-sm font-semibold">
                                                                            {linked.name || linked.title}
                                                                        </p>
                                                                        <p className="text-xs text-gray-400">
                                                                            {TAB_CONFIG[type]?.name}
                                                                        </p>
                                                                    </div>
                                                                </div>
                                                                {detailType !== 'notes' && (
                                                                    <button
                                                                        onClick={(e) => {
                                                                            e.stopPropagation();
                                                                            removeConnection(detailItem, detailType, linked, type);
                                                                        }}
                                                                        className="btn-secondary p-1"
                                                                    >
                                                                        <Icons.X className="w-4 h-4" />
                                                                    </button>
                                                                )}
                                                            </div>
                                                        ))
                                                    )}
                                                </div>
                                            ) : (
                                                <p className="text-gray-500 text-center py-8">Sin conexiones</p>
                                            )}
                                        </div>

                                        <div className="glass-light rounded-xl p-6">
                                            <h3 className="text-xl font-semibold text-white mb-4">Acciones</h3>
                                            <div className="space-y-3">
                                                <button
                                                    onClick={() => {
                                                        if (detailType === 'notes') {
                                                            setNewNote(detailItem);
                                                            setEditingNote(detailItem);
                                                            setShowNoteForm(true);
                                                        } else {
                                                            setNewItem(detailItem);
                                                            setFormType(detailType);
                                                            setIsEditing(true);
                                                            setShowForm(true);
                                                        }
                                                    }}
                                                    className="w-full btn-primary"
                                                >
                                                    <Icons.Edit2 />
                                                    Editar
                                                </button>
                                                <button
                                                    onClick={() => {
                                                        if (confirm('Â¿EstÃ¡s seguro de que quieres eliminar este elemento?')) {
                                                            const updates = {
                                                                ...currentCampaign,
                                                                [detailType]: currentCampaign[detailType].filter(
                                                                    item => item.id !== detailItem.id
                                                                )
                                                            };
                                                            updateCurrentCampaign(updates);
                                                            setShowDetailModal(false);
                                                        }
                                                    }}
                                                    className="w-full btn-secondary text-red-400 hover:text-red-300"
                                                >
                                                    <Icons.Trash2 />
                                                    Eliminar
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                );

                function renderDetailInfo() {
                    switch (detailType) {
                        case 'players':
                            return (
                                <div className="glass-light rounded-xl p-6">
                                    <h3 className="text-xl font-semibold text-white mb-4">InformaciÃ³n</h3>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <span className="text-gray-400">Jugador</span>
                                            <p className="text-white">{detailItem.player}</p>
                                        </div>
                                        <div>
                                            <span className="text-gray-400">Clase</span>
                                            <p className="text-white">{detailItem.class}</p>
                                        </div>
                                    </div>
                                    {detailItem.inventory && (
                                        <div className="mt-4">
                                            <h4 className="text-lg font-semibold text-white mb-2">Inventario</h4>
                                            <p className="text-gray-300">{detailItem.inventory}</p>
                                        </div>
                                    )}
                                </div>
                            );
                        case 'locations':
                            return (
                                <div className="glass-light rounded-xl p-6">
                                    <h3 className="text-xl font-semibold text-white mb-4">InformaciÃ³n</h3>
                                    <div className="space-y-3">
                                        <div className="flex justify-between">
                                            <span className="text-gray-400">Tipo</span>
                                            <span className="text-white">{detailItem.type}</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className="text-gray-400">Habitantes</span>
                                            <span className="text-white">{detailItem.inhabitants}</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className="text-gray-400">Importancia</span>
                                            <span className={`badge ${getPriorityColor(detailItem.importance)}`}>
                                                {detailItem.importance}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            );
                        case 'npcs':
                            return (
                                <div className="glass-light rounded-xl p-6">
                                    <h3 className="text-xl font-semibold text-white mb-4">InformaciÃ³n</h3>
                                    <div className="space-y-3">
                                        <div className="flex justify-between">
                                            <span className="text-gray-400">Rol</span>
                                            <span className="text-white">{detailItem.role}</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className="text-gray-400">UbicaciÃ³n</span>
                                            <span className="text-white">{detailItem.location}</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className="text-gray-400">Actitud</span>
                                            <span className={`font-semibold ${getAttitudeColor(detailItem.attitude)}`}>
                                                {detailItem.attitude}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            );
                        case 'quests':
                            return (
                                <div className="glass-light rounded-xl p-6">
                                    <h3 className="text-xl font-semibold text-white mb-4">Detalles</h3>
                                    <div className="space-y-3">
                                        <div className="flex justify-between">
                                            <span className="text-gray-400">Estado</span>
                                            <span className={`font-semibold ${getStatusColor(detailItem.status)}`}>
                                                {detailItem.status}
                                            </span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className="text-gray-400">UbicaciÃ³n</span>
                                            <span className="text-white">{detailItem.location}</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className="text-gray-400">Recompensa</span>
                                            <span className="text-yellow-400">{detailItem.reward}</span>
                                        </div>
                                    </div>
                                </div>
                            );
                        case 'objects':
                            return (
                                <div className="glass-light rounded-xl p-6">
                                    <h3 className="text-xl font-semibold text-white mb-4">InformaciÃ³n</h3>
                                    <div className="space-y-3">
                                        <div className="flex justify-between">
                                            <span className="text-gray-400">Tipo</span>
                                            <span className="text-white">{detailItem.type}</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className="text-gray-400">Rareza</span>
                                            <span className={`badge ${getRarityColor(detailItem.rarity)}`}>
                                                {detailItem.rarity}
                                            </span>
                                        </div>
                                        {detailItem.owner && (
                                            <div className="flex justify-between">
                                                <span className="text-gray-400">Propietario</span>
                                                <span className="text-white">{detailItem.owner}</span>
                                            </div>
                                        )}
                                        {detailItem.location && (
                                            <div className="flex justify-between">
                                                <span className="text-gray-400">UbicaciÃ³n</span>
                                                <span className="text-white">{detailItem.location}</span>
                                            </div>
                                        )}
                                    </div>
                                    {detailItem.properties && (
                                        <div className="mt-4">
                                            <h4 className="text-lg font-semibold text-white mb-2">Propiedades</h4>
                                            <p className="text-gray-300">{detailItem.properties}</p>
                                        </div>
                                    )}
                                </div>
                            );
                        default:
                            return null;
                    }
                }
            };

            // Renderizado de formularios
            const renderForm = () => {
                const forms = {
                    locations: (
                        <div className="space-y-4">
                            <div className="flex items-center gap-4">
                                <div className="flex-1">
                                    <label className="field-label">Nombre del lugar</label>
                                    <input
                                        type="text"
                                        placeholder="Ej: Taberna del DragÃ³n Dorado"
                                        className="input-field"
                                        value={newItem.name || ''}
                                        onChange={(e) => setNewItem({...newItem, name: e.target.value})}
                                        autoFocus
                                    />
                                    <p className="field-hint">El nombre por el que se conoce este lugar</p>
                                </div>
                                <div>
                                    <label className="field-label">Icono</label>
                                    <button
                                        type="button"
                                        onClick={() => {
                                            setEmojiTarget('icon');
                                            setShowEmojiPicker(true);
                                        }}
                                        className="w-16 h-12 glass-light rounded-lg flex items-center justify-center text-2xl hover:bg-gray-600 transition-all"
                                    >
                                        {newItem.icon || 'ğŸ›ï¸'}
                                    </button>
                                </div>
                            </div>
                            <div>
                                <label className="field-label">Tipo de lugar</label>
                                <input
                                    type="text"
                                    placeholder="Ej: Ciudad, Pueblo, Mazmorra, Bosque"
                                    className="input-field"
                                    value={newItem.type || ''}
                                    onChange={(e) => setNewItem({...newItem, type: e.target.value})}
                                />
                                <p className="field-hint">CategorÃ­a o tipo de ubicaciÃ³n</p>
                            </div>
                            <div>
                                <label className="field-label">DescripciÃ³n breve</label>
                                <textarea
                                    placeholder="Una breve descripciÃ³n del lugar..."
                                    className="input-field h-24 resize-none"
                                    value={newItem.description || ''}
                                    onChange={(e) => setNewItem({...newItem, description: e.target.value})}
                                />
                                <p className="field-hint">Resumen rÃ¡pido del lugar (2-3 lÃ­neas)</p>
                            </div>
                            <div>
                                <label className="field-label">DescripciÃ³n detallada</label>
                                <WYSIWYGEditor
                                    value={newItem.detailedDescription || ''}
                                    onChange={(value) => setNewItem({...newItem, detailedDescription: value})}
                                    placeholder="Historia, lugares de interÃ©s, secretos..."
                                />
                                <p className="field-hint">Historia completa, puntos de interÃ©s, secretos ocultos, etc.</p>
                            </div>
                            <div>
                                <label className="field-label">Habitantes</label>
                                <input
                                    type="text"
                                    placeholder="Ej: 5000 habitantes, Mayormente elfos"
                                    className="input-field"
                                    value={newItem.inhabitants || ''}
                                    onChange={(e) => setNewItem({...newItem, inhabitants: e.target.value})}
                                />
                                <p className="field-hint">PoblaciÃ³n y demografÃ­a del lugar</p>
                            </div>
                            <div>
                                <label className="field-label">Importancia</label>
                                <CustomSelect
                                    value={newItem.importance || 'Media'}
                                    onChange={(value) => setNewItem({...newItem, importance: value})}
                                    options={[
                                        { value: 'Baja', label: 'Importancia Baja' },
                                        { value: 'Media', label: 'Importancia Media' },
                                        { value: 'Alta', label: 'Importancia Alta' },
                                        { value: 'CrÃ­tica', label: 'Importancia CrÃ­tica' }
                                    ]}
                                />
                                <p className="field-hint">Relevancia del lugar en la campaÃ±a</p>
                            </div>
                        </div>
                    ),
                    players: (
                        <div className="space-y-4">
                            <div className="flex items-center gap-4">
                                <div className="flex-1">
                                    <label className="field-label">Nombre del personaje</label>
                                    <input
                                        type="text"
                                        placeholder="Ej: Thorin EscudofÃ©rro"
                                        className="input-field"
                                        value={newItem.name || ''}
                                        onChange={(e) => setNewItem({...newItem, name: e.target.value})}
                                        autoFocus
                                    />
                                    <p className="field-hint">Nombre del personaje jugador</p>
                                </div>
                                <div>
                                    <label className="field-label">Avatar</label>
                                    <button
                                        type="button"
                                        onClick={() => {
                                            setEmojiTarget('avatar');
                                            setShowEmojiPicker(true);
                                        }}
                                        className="w-16 h-12 glass-light rounded-lg flex items-center justify-center text-2xl hover:bg-gray-600 transition-all"
                                    >
                                        {newItem.avatar || 'âš”ï¸'}
                                    </button>
                                </div>
                            </div>
                            <div>
                                <label className="field-label">Nombre del jugador</label>
                                <input
                                    type="text"
                                    placeholder="Ej: Juan GarcÃ­a"
                                    className="input-field"
                                    value={newItem.player || ''}
                                    onChange={(e) => setNewItem({...newItem, player: e.target.value})}
                                />
                                <p className="field-hint">Nombre real de la persona que juega este personaje</p>
                            </div>
                            <div>
                                <label className="field-label">Clase</label>
                                <input
                                    type="text"
                                    placeholder="Ej: Guerrero, Mago, PÃ­caro"
                                    className="input-field"
                                    value={newItem.class || ''}
                                    onChange={(e) => setNewItem({...newItem, class: e.target.value})}
                                />
                                <p className="field-hint">Clase del personaje</p>
                            </div>
                            <div>
                                <label className="field-label">DescripciÃ³n del personaje</label>
                                <textarea
                                    placeholder="Apariencia, personalidad, peculiaridades..."
                                    className="input-field h-24 resize-none"
                                    value={newItem.description || ''}
                                    onChange={(e) => setNewItem({...newItem, description: e.target.value})}
                                />
                                <p className="field-hint">Breve descripciÃ³n del personaje</p>
                            </div>
                            <div>
                                <label className="field-label">Historia del personaje</label>
                                <WYSIWYGEditor
                                    value={newItem.backstory || ''}
                                    onChange={(value) => setNewItem({...newItem, backstory: value})}
                                    placeholder="Origen, motivaciÃ³n, rasgos..."
                                />
                                <p className="field-hint">Historia completa, motivaciones, conexiones familiares, etc.</p>
                            </div>
                            <div>
                                <label className="field-label">Inventario</label>
                                <textarea
                                    placeholder="Lista de objetos, armas, pociones..."
                                    className="input-field h-24 resize-none"
                                    value={newItem.inventory || ''}
                                    onChange={(e) => setNewItem({...newItem, inventory: e.target.value})}
                                />
                                <p className="field-hint">Objetos y equipo que lleva el personaje</p>
                            </div>
                        </div>
                    ),
                    npcs: (
                        <div className="space-y-4">
                            <div className="flex items-center gap-4">
                                <div className="flex-1">
                                    <label className="field-label">Nombre del NPC</label>
                                    <input
                                        type="text"
                                        placeholder="Ej: Eldara la Sabia"
                                        className="input-field"
                                        value={newItem.name || ''}
                                        onChange={(e) => setNewItem({...newItem, name: e.target.value})}
                                        autoFocus
                                    />
                                    <p className="field-hint">Nombre del personaje no jugador</p>
                                </div>
                                <div>
                                    <label className="field-label">Icono</label>
                                    <button
                                        type="button"
                                        onClick={() => {
                                            setEmojiTarget('icon');
                                            setShowEmojiPicker(true);
                                        }}
                                        className="w-16 h-12 glass-light rounded-lg flex items-center justify-center text-2xl hover:bg-gray-600 transition-all"
                                    >
                                        {newItem.icon || 'ğŸ‘¤'}
                                    </button>
                                </div>
                            </div>
                            <div>
                                <label className="field-label">Rol o profesiÃ³n</label>
                                <input
                                    type="text"
                                    placeholder="Ej: Comerciante, Guardia, Noble, Sabio"
                                    className="input-field"
                                    value={newItem.role || ''}
                                    onChange={(e) => setNewItem({...newItem, role: e.target.value})}
                                />
                                <p className="field-hint">OcupaciÃ³n o papel en la sociedad</p>
                            </div>
                            <div>
                                <label className="field-label">UbicaciÃ³n habitual</label>
                                <input
                                    type="text"
                                    placeholder="Ej: Mercado central, Torre del mago"
                                    className="input-field"
                                    value={newItem.location || ''}
                                    onChange={(e) => setNewItem({...newItem, location: e.target.value})}
                                />
                                <p className="field-hint">DÃ³nde se puede encontrar normalmente a este NPC</p>
                            </div>
                            <div>
                                <label className="field-label">DescripciÃ³n breve</label>
                                <textarea
                                    placeholder="Apariencia y primeras impresiones..."
                                    className="input-field h-24 resize-none"
                                    value={newItem.description || ''}
                                    onChange={(e) => setNewItem({...newItem, description: e.target.value})}
                                />
                                <p className="field-hint">Lo primero que notan los jugadores</p>
                            </div>
                            <div>
                                <label className="field-label">InformaciÃ³n detallada</label>
                                <WYSIWYGEditor
                                    value={newItem.detailedDescription || ''}
                                    onChange={(value) => setNewItem({...newItem, detailedDescription: value})}
                                    placeholder="Apariencia, personalidad, secretos..."
                                />
                                <p className="field-hint">Personalidad, secretos, motivaciones, conexiones con otros NPCs</p>
                            </div>
                            <div>
                                <label className="field-label">Actitud hacia los jugadores</label>
                                <CustomSelect
                                    value={newItem.attitude || 'Neutral'}
                                    onChange={(value) => setNewItem({...newItem, attitude: value})}
                                    options={[
                                        { value: 'Amistoso', label: 'Actitud Amistosa' },
                                        { value: 'Neutral', label: 'Actitud Neutral' },
                                        { value: 'Hostil', label: 'Actitud Hostil' }
                                    ]}
                                />
                                <p className="field-hint">DisposiciÃ³n inicial hacia el grupo</p>
                            </div>
                        </div>
                    ),
                    quests: (
                        <div className="space-y-4">
                            <div className="flex items-center gap-4">
                                <div className="flex-1">
                                    <label className="field-label">TÃ­tulo de la misiÃ³n</label>
                                    <input
                                        type="text"
                                        placeholder="Ej: El Rescate del PrÃ­ncipe Perdido"
                                        className="input-field"
                                        value={newItem.title || ''}
                                        onChange={(e) => setNewItem({...newItem, title: e.target.value})}
                                        autoFocus
                                    />
                                    <p className="field-hint">Nombre memorable para la misiÃ³n</p>
                                </div>
                                <div>
                                    <label className="field-label">Icono</label>
                                    <button
                                        type="button"
                                        onClick={() => {
                                            setEmojiTarget('icon');
                                            setShowEmojiPicker(true);
                                        }}
                                        className="w-16 h-12 glass-light rounded-lg flex items-center justify-center text-2xl hover:bg-gray-600 transition-all"
                                    >
                                        {newItem.icon || 'ğŸ“œ'}
                                    </button>
                                </div>
                            </div>
                            <div>
                                <label className="field-label">DescripciÃ³n breve</label>
                                <textarea
                                    placeholder="Resumen de la misiÃ³n en pocas lÃ­neas..."
                                    className="input-field h-24 resize-none"
                                    value={newItem.description || ''}
                                    onChange={(e) => setNewItem({...newItem, description: e.target.value})}
                                />
                                <p className="field-hint">Resumen rÃ¡pido de los objetivos</p>
                            </div>
                            <div>
                                <label className="field-label">Detalles de la misiÃ³n</label>
                                <WYSIWYGEditor
                                    value={newItem.detailedDescription || ''}
                                    onChange={(value) => setNewItem({...newItem, detailedDescription: value})}
                                    placeholder="Objetivos, pistas, progreso..."
                                />
                                <p className="field-hint">Objetivos detallados, pistas, NPCs involucrados, progreso actual</p>
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="field-label">UbicaciÃ³n</label>
                                    <input
                                        type="text"
                                        placeholder="Ej: Bosque SombrÃ­o"
                                        className="input-field"
                                        value={newItem.location || ''}
                                        onChange={(e) => setNewItem({...newItem, location: e.target.value})}
                                    />
                                    <p className="field-hint">DÃ³nde tiene lugar la misiÃ³n</p>
                                </div>
                                <div>
                                    <label className="field-label">Recompensa</label>
                                    <input
                                        type="text"
                                        placeholder="Ej: 500 oro + espada mÃ¡gica"
                                        className="input-field"
                                        value={newItem.reward || ''}
                                        onChange={(e) => setNewItem({...newItem, reward: e.target.value})}
                                    />
                                    <p className="field-hint">Oro, objetos o informaciÃ³n</p>
                                </div>
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="field-label">Estado de la misiÃ³n</label>
                                    <CustomSelect
                                        value={newItem.status || 'Pendiente'}
                                        onChange={(value) => setNewItem({...newItem, status: value})}
                                        options={[
                                            { value: 'Pendiente', label: 'Estado: Pendiente' },
                                            { value: 'En progreso', label: 'Estado: En progreso' },
                                            { value: 'Completada', label: 'Estado: Completada' }
                                        ]}
                                    />
                                    <p className="field-hint">Progreso actual</p>
                                </div>
                                <div>
                                    <label className="field-label">Prioridad</label>
                                    <CustomSelect
                                        value={newItem.priority || 'Media'}
                                        onChange={(value) => setNewItem({...newItem, priority: value})}
                                        options={[
                                            { value: 'Baja', label: 'Prioridad Baja' },
                                            { value: 'Media', label: 'Prioridad Media' },
                                            { value: 'Alta', label: 'Prioridad Alta' },
                                            { value: 'CrÃ­tica', label: 'Prioridad CrÃ­tica' }
                                        ]}
                                    />
                                    <p className="field-hint">Urgencia de la misiÃ³n</p>
                                </div>
                            </div>
                        </div>
                    ),
                    objects: (
                        <div className="space-y-4">
                            <div className="flex items-center gap-4">
                                <div className="flex-1">
                                    <label className="field-label">Nombre del objeto</label>
                                    <input
                                        type="text"
                                        placeholder="Ej: Espada de la Luna Creciente"
                                        className="input-field"
                                        value={newItem.name || ''}
                                        onChange={(e) => setNewItem({...newItem, name: e.target.value})}
                                        autoFocus
                                    />
                                    <p className="field-hint">Nombre del objeto mÃ¡gico o importante</p>
                                </div>
                                <div>
                                    <label className="field-label">Icono</label>
                                    <button
                                        type="button"
                                        onClick={() => {
                                            setEmojiTarget('icon');
                                            setShowEmojiPicker(true);
                                        }}
                                        className="w-16 h-12 glass-light rounded-lg flex items-center justify-center text-2xl hover:bg-gray-600 transition-all"
                                    >
                                        {newItem.icon || 'ğŸ’'}
                                    </button>
                                </div>
                            </div>
                            <div>
                                <label className="field-label">Tipo de objeto</label>
                                <input
                                    type="text"
                                    placeholder="Ej: Arma, Armadura, PociÃ³n, Artefacto"
                                    className="input-field"
                                    value={newItem.type || ''}
                                    onChange={(e) => setNewItem({...newItem, type: e.target.value})}
                                />
                                <p className="field-hint">CategorÃ­a del objeto</p>
                            </div>
                            <div>
                                <label className="field-label">DescripciÃ³n breve</label>
                                <textarea
                                    placeholder="Apariencia y caracterÃ­sticas bÃ¡sicas..."
                                    className="input-field h-24 resize-none"
                                    value={newItem.description || ''}
                                    onChange={(e) => setNewItem({...newItem, description: e.target.value})}
                                />
                                <p className="field-hint">DescripciÃ³n visual y caracterÃ­sticas generales</p>
                            </div>
                            <div>
                                <label className="field-label">Historia y propiedades</label>
                                <WYSIWYGEditor
                                    value={newItem.detailedDescription || ''}
                                    onChange={(value) => setNewItem({...newItem, detailedDescription: value})}
                                    placeholder="Historia del objeto, poderes mÃ¡gicos, maldiciones..."
                                />
                                <p className="field-hint">Origen, historia, propiedades mÃ¡gicas, efectos especiales</p>
                            </div>
                            <div>
                                <label className="field-label">Propiedades mecÃ¡nicas</label>
                                <textarea
                                    placeholder="Ej: +2 al ataque, resistencia al fuego, 3 cargas diarias..."
                                    className="input-field h-24 resize-none"
                                    value={newItem.properties || ''}
                                    onChange={(e) => setNewItem({...newItem, properties: e.target.value})}
                                />
                                <p className="field-hint">EstadÃ­sticas, bonificaciones, efectos mecÃ¡nicos</p>
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="field-label">Rareza</label>
                                    <CustomSelect
                                        value={newItem.rarity || 'ComÃºn'}
                                        onChange={(value) => setNewItem({...newItem, rarity: value})}
                                        options={[
                                            { value: 'ComÃºn', label: 'ComÃºn' },
                                            { value: 'Poco comÃºn', label: 'Poco comÃºn' },
                                            { value: 'Raro', label: 'Raro' },
                                            { value: 'Ã‰pico', label: 'Ã‰pico' },
                                            { value: 'Legendario', label: 'Legendario' }
                                        ]}
                                    />
                                    <p className="field-hint">Nivel de rareza del objeto</p>
                                </div>
                                <div>
                                    <label className="field-label">Propietario actual</label>
                                    <input
                                        type="text"
                                        placeholder="Ej: En posesiÃ³n de Thorin"
                                        className="input-field"
                                        value={newItem.owner || ''}
                                        onChange={(e) => setNewItem({...newItem, owner: e.target.value})}
                                    />
                                    <p className="field-hint">QuiÃ©n posee el objeto actualmente</p>
                                </div>
                            </div>
                            <div>
                                <label className="field-label">UbicaciÃ³n</label>
                                <input
                                    type="text"
                                    placeholder="Ej: Cripta del Rey Olvidado"
                                    className="input-field"
                                    value={newItem.location || ''}
                                    onChange={(e) => setNewItem({...newItem, location: e.target.value})}
                                />
                                <p className="field-hint">DÃ³nde se encuentra el objeto si no tiene propietario</p>
                            </div>
                        </div>
                    )
                };

                return forms[formType] || null;
            };

            // Vista de campaÃ±a principal
            const renderCampaignView = () => {
                if (!currentCampaign) {
                    return (
                        <div className="min-h-screen gradient-bg p-6 flex items-center justify-center">
                            <div className="text-center">
                                <p className="text-gray-400 text-xl mb-4">No se ha seleccionado ninguna campaÃ±a</p>
                                <button onClick={() => setView('selector')} className="btn-primary">
                                    Volver a campaÃ±as
                                </button>
                            </div>
                        </div>
                    );
                }

                const searchResults = searchAllItems();

                return (
                    <div className="min-h-screen gradient-bg flex flex-col">
                        {/* NavegaciÃ³n superior */}
                        <nav className="navigation-header">
                            <div className="nav-container">
                                <div className="nav-brand">
                                    <button
                                        onClick={() => setView('selector')}
                                        className="btn-secondary"
                                    >
                                        <Icons.ArrowLeft />
                                        <span className="hidden lg:inline">CampaÃ±as</span>
                                    </button>
                                </div>
                                
                                <div className="nav-tabs-wrapper">
                                    <div className="nav-tabs-container">
                                        {TAB_ORDER.map(tabKey => {
                                            const config = TAB_CONFIG[tabKey];
                                            return (
                                                <button
                                                    key={tabKey}
                                                    onClick={() => setActiveTab(tabKey)}
                                                    className={`nav-tab ${activeTab === tabKey ? 'active' : ''}`}
                                                >
                                                    <config.icon />
                                                    <span>{config.name}</span>
                                                </button>
                                            );
                                        })}
                                    </div>
                                </div>
                                
                                <div className="nav-actions">
                                    <div className="search-container">
                                        <div className="search-input-wrapper">
                                            <Icons.Search className="search-icon" />
                                            <input
                                                ref={searchInputRef}
                                                type="text"
                                                placeholder="Buscar..."
                                                className="search-input"
                                                value={searchTerm}
                                                onChange={(e) => {
                                                    setSearchTerm(e.target.value);
                                                    setShowSearchDropdown(!!e.target.value);
                                                }}
                                                onFocus={() => setShowSearchDropdown(!!searchTerm)}
                                                onBlur={(e) => {
                                                    // Delay para permitir clicks en dropdown
                                                    setTimeout(() => {
                                                        if (!e.currentTarget.contains(document.activeElement)) {
                                                            setShowSearchDropdown(false);
                                                        }
                                                    }, 200);
                                                }}
                                            />
                                        </div>
                                        {showSearchDropdown && searchResults.length > 0 && (
                                            <SearchDropdown
                                                searchTerm={searchTerm}
                                                results={searchResults}
                                                onItemClick={handleItemClick}
                                                onClose={() => {
                                                    setSearchTerm('');
                                                    setShowSearchDropdown(false);
                                                }}
                                            />
                                        )}
                                    </div>
                                    <button
                                        onClick={() => exportCampaign(currentCampaignId)}
                                        className="btn-secondary p-2 tooltip"
                                        data-tooltip="Exportar"
                                    >
                                        <Icons.Download />
                                    </button>
                                </div>
                            </div>
                        </nav>

                        {/* Contenido principal */}
                        <div className="main-content p-6">
                            <div className="content-panel">
                                {activeTab === 'dashboard' && renderDashboard()}
                                {activeTab === 'locations' && (
                                    <ItemList
                                        items={currentCampaign.locations || []}
                                        type="locations"
                                        title="Lugares"
                                        Icon={Icons.MapPin}
                                        colorClass="text-blue-400"
                                        onItemClick={handleItemClick}
                                        onAddNew={handleAddNew}
                                        searchTerm={searchTerm}
                                    />
                                )}
                                {activeTab === 'players' && (
                                    <ItemList
                                        items={currentCampaign.players || []}
                                        type="players"
                                        title="Jugadores"
                                        Icon={Icons.Users}
                                        colorClass="text-green-400"
                                        onItemClick={handleItemClick}
                                        onAddNew={handleAddNew}
                                        searchTerm={searchTerm}
                                    />
                                )}
                                {activeTab === 'npcs' && (
                                    <ItemList
                                        items={currentCampaign.npcs || []}
                                        type="npcs"
                                        title="NPCs"
                                        Icon={Icons.User}
                                        colorClass="text-purple-400"
                                        onItemClick={handleItemClick}
                                        onAddNew={handleAddNew}
                                        searchTerm={searchTerm}
                                    />
                                )}
                                {activeTab === 'objects' && (
                                    <ItemList
                                        items={currentCampaign.objects || []}
                                        type="objects"
                                        title="Objetos"
                                        Icon={Icons.Package}
                                        colorClass="text-cyan-400"
                                        onItemClick={handleItemClick}
                                        onAddNew={handleAddNew}
                                        searchTerm={searchTerm}
                                    />
                                )}
                                {activeTab === 'quests' && (
                                    <ItemList
                                        items={currentCampaign.quests || []}
                                        type="quests"
                                        title="Misiones"
                                        Icon={Icons.Scroll}
                                        colorClass="text-orange-400"
                                        onItemClick={handleItemClick}
                                        onAddNew={handleAddNew}
                                        searchTerm={searchTerm}
                                    />
                                )}
                                {activeTab === 'notes' && renderNotes()}
                            </div>

                            {/* Modales */}
                            {showDetailModal && renderDetailModal()}

                            {/* Modal de formulario */}
                            {showForm && (
                                <div className="modal-backdrop">
                                    <div className="modal-content glass max-w-3xl w-full">
                                        <div className="modal-header">
                                            <div className="flex justify-between items-center">
                                                <h3 className="text-2xl font-bold text-white">
                                                    {isEditing ? 'Editar' : 'Nuevo'} {
                                                        formType === 'locations' ? 'Lugar' : 
                                                        formType === 'players' ? 'Jugador' : 
                                                        formType === 'npcs' ? 'NPC' : 
                                                        formType === 'objects' ? 'Objeto' : 'MisiÃ³n'
                                                    }
                                                </h3>
                                                <button onClick={() => setShowForm(false)} className="btn-secondary p-2">
                                                    <Icons.X />
                                                </button>
                                            </div>
                                        </div>
                                        <div className="modal-body">
                                            {renderForm()}
                                        </div>
                                        <div className="modal-footer flex justify-end gap-4">
                                            <button onClick={() => setShowForm(false)} className="btn-secondary">
                                                Cancelar
                                            </button>
                                            <button onClick={handleSave} className="btn-primary">
                                                <Icons.Save />
                                                Guardar
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* Modal de notas */}
                            {showNoteForm && (
                                <div className="modal-backdrop">
                                    <div className="modal-content glass max-w-3xl w-full">
                                        <div className="modal-header">
                                            <div className="flex justify-between items-center">
                                                <h3 className="text-2xl font-bold text-white">
                                                    {editingNote ? 'Editar' : 'Nueva'} Nota
                                                </h3>
                                                <button
                                                    onClick={() => {
                                                        setShowNoteForm(false);
                                                        setEditingNote(null);
                                                        setNewNote({
                                                            title: '',
                                                            content: '',
                                                            linkedItems: { locations: [], players: [], npcs: [], quests: [], objects: [] }
                                                        });
                                                    }}
                                                    className="btn-secondary p-2"
                                                >
                                                    <Icons.X />
                                                </button>
                                            </div>
                                        </div>
                                        <div className="modal-body space-y-4">
                                            <div>
                                                <label className="field-label">TÃ­tulo de la nota</label>
                                                <input
                                                    type="text"
                                                    placeholder="Ej: Secretos del Bosque Oscuro"
                                                    className="input-field"
                                                    value={newNote.title || ''}
                                                    onChange={(e) => setNewNote({...newNote, title: e.target.value})}
                                                    autoFocus
                                                />
                                                <p className="field-hint">Un tÃ­tulo descriptivo para encontrar fÃ¡cilmente esta nota</p>
                                            </div>
                                            <div>
                                                <label className="field-label">Contenido de la nota</label>
                                                <WYSIWYGEditor
                                                    value={newNote.content || ''}
                                                    onChange={(value) => setNewNote({...newNote, content: value})}
                                                    placeholder="Escribe tus notas aquÃ­..."
                                                />
                                                <p className="field-hint">Notas importantes sobre la campaÃ±a, ideas, recordatorios...</p>
                                            </div>
                                            
                                            {/* Conexiones de notas */}
                                            <div>
                                                <label className="field-label">Elementos vinculados</label>
                                                <div className="grid grid-cols-2 md:grid-cols-5 gap-3 mb-4">
                                                    {['locations', 'players', 'npcs', 'quests', 'objects'].map(type => {
                                                        const typeInfo = TAB_CONFIG[type];
                                                        const linkedCount = newNote.linkedItems?.[type]?.length || 0;
                                                        const IconComponent = typeInfo.icon;
                                                        
                                                        return (
                                                            <button
                                                                key={type}
                                                                type="button"
                                                                onClick={() => {
                                                                    setConnectionSource({ item: newNote, type: 'notes' });
                                                                    setShowConnectionModal(true);
                                                                }}
                                                                className={`p-3 rounded-lg transition-all flex flex-col items-center gap-2 ${
                                                                    linkedCount > 0
                                                                        ? 'glass bg-purple-600 bg-opacity-20 text-purple-400 border border-purple-500'
                                                                        : 'glass-light text-gray-300 hover:bg-gray-700'
                                                                }`}
                                                            >
                                                                <IconComponent />
                                                                <span className="text-sm font-medium">
                                                                    {typeInfo.name} ({linkedCount})
                                                                </span>
                                                            </button>
                                                        );
                                                    })}
                                                </div>
                                                <p className="field-hint">Vincula esta nota con elementos especÃ­ficos de la campaÃ±a</p>
                                                
                                                {/* Lista de elementos vinculados */}
                                                {Object.entries(newNote.linkedItems || {}).map(([type, ids]) => {
                                                    if (!ids || ids.length === 0) return null;
                                                    
                                                    return (
                                                        <div key={type} className="mt-4">
                                                            <h4 className="text-sm font-medium text-gray-400 mb-2">
                                                                {TAB_CONFIG[type]?.name} vinculados:
                                                            </h4>
                                                            <div className="space-y-2">
                                                                {ids.map(id => {
                                                                    const item = currentCampaign?.[type]?.find(i => i.id === id);
                                                                    if (!item) return null;
                                                                    
                                                                    return (
                                                                        <div key={id} className="flex items-center justify-between glass-light rounded-lg p-3">
                                                                            <div className="flex items-center">
                                                                                <span className="text-2xl mr-3">
                                                                                    {item.icon || item.avatar || 'ğŸ“‹'}
                                                                                </span>
                                                                                <span className="text-white">
                                                                                    {item.name || item.title}
                                                                                </span>
                                                                            </div>
                                                                            <button
                                                                                type="button"
                                                                                onClick={() => {
                                                                                    setNewNote({
                                                                                        ...newNote,
                                                                                        linkedItems: {
                                                                                            ...newNote.linkedItems,
                                                                                            [type]: newNote.linkedItems[type].filter(i => i !== id)
                                                                                        }
                                                                                    });
                                                                                }}
                                                                                className="btn-secondary p-1"
                                                                            >
                                                                                <Icons.X className="w-4 h-4" />
                                                                            </button>
                                                                        </div>
                                                                    );
                                                                })}
                                                            </div>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        </div>
                                        <div className="modal-footer flex justify-end gap-4">
                                            <button
                                                onClick={() => {
                                                    setShowNoteForm(false);
                                                    setEditingNote(null);
                                                    setNewNote({
                                                        title: '',
                                                        content: '',
                                                        linkedItems: { locations: [], players: [], npcs: [], quests: [], objects: [] }
                                                    });
                                                }}
                                                className="btn-secondary"
                                            >
                                                Cancelar
                                            </button>
                                            <button onClick={handleSaveNote} className="btn-primary">
                                                <Icons.Save />
                                                Guardar
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* Modal de conexiones */}
                            {showConnectionModal && connectionSource && (
                                <ConnectionModal
                                    sourceItem={connectionSource.item}
                                    sourceType={connectionSource.type}
                                    onClose={() => {
                                        setShowConnectionModal(false);
                                        setConnectionSource(null);
                                    }}
                                />
                            )}

                            {/* Selector de emojis */}
                            {showEmojiPicker && (
                                <EmojiPicker
                                    onSelect={(emoji) => {
                                        setNewItem({
                                            ...newItem,
                                            [emojiTarget]: emoji
                                        });
                                        setShowEmojiPicker(false);
                                        setEmojiTarget(null);
                                    }}
                                    onClose={() => {
                                        setShowEmojiPicker(false);
                                        setEmojiTarget(null);
                                    }}
                                />
                            )}
                        </div>
                    </div>
                );
            };

            // Modal de nueva campaÃ±a
            const renderNewCampaignModal = () => showNewCampaignModal && (
                <div className="modal-backdrop">
                    <div className="modal-content glass max-w-lg w-full">
                        <div className="p-8">
                            <h3 className="text-3xl font-bold text-white mb-6 flex items-center">
                                <Icons.Sparkles className="mr-3 text-purple-400" />
                                Nueva CampaÃ±a
                            </h3>
                            <div className="space-y-6">
                                <div>
                                    <label className="field-label">Nombre de la campaÃ±a</label>
                                    <input
                                        type="text"
                                        placeholder="Ej: Las CrÃ³nicas de Eldoria"
                                        className="input-field text-lg"
                                        value={newCampaignName}
                                        onChange={(e) => setNewCampaignName(e.target.value)}
                                        autoFocus
                                    />
                                    <p className="field-hint">Un nombre Ã©pico para tu aventura</p>
                                </div>
                                <div>
                                    <label className="field-label">DescripciÃ³n</label>
                                    <textarea
                                        placeholder="DescripciÃ³n de tu mundo de aventuras..."
                                        className="input-field h-32 resize-none"
                                        value={newCampaignDescription}
                                        onChange={(e) => setNewCampaignDescription(e.target.value)}
                                    />
                                    <p className="field-hint">Una breve sinopsis de la campaÃ±a</p>
                                </div>
                            </div>
                            <div className="flex justify-end gap-4 mt-8">
                                <button
                                    onClick={() => {
                                        setShowNewCampaignModal(false);
                                        setNewCampaignName('');
                                        setNewCampaignDescription('');
                                    }}
                                    className="btn-secondary"
                                >
                                    Cancelar
                                </button>
                                <button onClick={createNewCampaign} className="btn-primary">
                                    <Icons.Plus />
                                    Crear CampaÃ±a
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );

            // Renderizado principal
            return (
                <>
                    {view === 'selector' ? renderCampaignSelector() : renderCampaignView()}
                    {renderNewCampaignModal()}
                </>
            );
        };

        // Renderizar la aplicaciÃ³n
        ReactDOM.render(
            <DnDCampaignManager />, 
            document.getElementById('root')
        );
    </script>
</body>
</html>
        